[{"id":"aca500a5.26ea7","type":"tab","label":"Albert Master","disabled":false,"info":""},{"id":"72706932.2ca048","type":"tab","label":"Albert Worker","disabled":false,"info":""},{"id":"d94fb931.bab888","type":"subflow","name":"1Betpro.com Session","info":"","in":[{"x":80,"y":100,"wires":[{"id":"15c93f15.719d71"}]}],"out":[{"x":1300,"y":140,"wires":[{"id":"c49073ad.50203","port":0},{"id":"87e56684.c18a38","port":0}]},{"x":1120,"y":40,"wires":[{"id":"a7be1e21.862a5","port":0}]}]},{"id":"6ca7ba6a.fb6f14","type":"subflow","name":"Bot Starter","info":"","in":[{"x":40,"y":140,"wires":[{"id":"776d9b53.b4dba4"}]}],"out":[{"x":900,"y":140,"wires":[{"id":"d7e13ed0.a2355","port":0}]}]},{"id":"faf2e075.8588c","type":"subflow","name":"966sport Request","info":"","in":[{"x":320,"y":220,"wires":[{"id":"a2128ad1.29f588"}]}],"out":[{"x":1020,"y":220,"wires":[{"id":"b2469cd2.9f36e","port":0}]}]},{"id":"bda9989.3a98068","type":"subflow","name":"For Each Page","info":"","in":[{"x":240,"y":160,"wires":[{"id":"1528693d.0811d7"}]}],"out":[{"x":1180,"y":160,"wires":[{"id":"a65dba6.f920e48","port":0}]}]},{"id":"29cf43c4.26adec","type":"subflow","name":"Elasticsearch Merge","info":"","in":[{"x":60,"y":280,"wires":[{"id":"463f84ea.2a9dbc"}]}],"out":[{"x":1320,"y":240,"wires":[{"id":"d0f85fd9.2da0d","port":0}]},{"x":1320,"y":320,"wires":[{"id":"fa556f64.980fd","port":0}]},{"x":1320,"y":160,"wires":[{"id":"78dcc27.5dc073c","port":0}]}]},{"id":"52f2656a.61247c","type":"subflow","name":"1Betpro.com Line Transform","info":"","in":[{"x":20,"y":280,"wires":[{"id":"5f9e7951.b92058"}]}],"out":[{"x":600,"y":280,"wires":[{"id":"58691bd5.d808c4","port":0}]}]},{"id":"fd5c9c45.e7c55","type":"subflow","name":"List 1BetPro Events","info":"","in":[{"x":60,"y":200,"wires":[{"id":"5f9d13c3.c32d0c"}]}],"out":[{"x":1540,"y":200,"wires":[{"id":"84f6d07e.16321","port":0}]}]},{"id":"8d7750f6.a91db","type":"subflow","name":"List Lines","info":"","in":[{"x":380,"y":240,"wires":[{"id":"8271efd5.73b9"}]}],"out":[{"x":980,"y":240,"wires":[{"id":"de22efe5.6e2f4","port":0}]}]},{"id":"520d204a.6248b","type":"subflow","name":"For Each Game","info":"","in":[{"x":500,"y":220,"wires":[{"id":"e842ceac.82bd7"}]}],"out":[{"x":1180,"y":220,"wires":[{"id":"fb3d627c.b4bff","port":0}]}]},{"id":"b7eb2a5f.2481a8","type":"subflow","name":"966Sport.com Session","info":"","in":[{"x":100,"y":240,"wires":[{"id":"64b40aef.230484"}]}],"out":[{"x":1320,"y":280,"wires":[{"id":"a56d9438.4aa278","port":0},{"id":"f6c6cfcb.de8af","port":0}]},{"x":1120,"y":160,"wires":[{"id":"62fe0d24.d84414","port":"0"}]}]},{"id":"dd2ff415.75e098","type":"subflow","name":"966Sport Line Transform","info":"","in":[{"x":40,"y":240,"wires":[{"id":"d510851f.9e89a8"}]}],"out":[{"x":600,"y":240,"wires":[{"id":"8c3672cd.acb0b","port":0}]}]},{"id":"987d9c15.b3c5","type":"subflow","name":"Google Search","info":"","in":[{"x":20,"y":560,"wires":[{"id":"33383dcd.33b232"}]}],"out":[{"x":3480,"y":520,"wires":[{"id":"30cd385b.2d81a8","port":0},{"id":"d8890ab8.a55588","port":0}]}]},{"id":"4831be77.6607b","type":"subflow","name":"1BetPro Request","info":"","in":[{"x":380,"y":220,"wires":[{"id":"90a915b4.cfd408"}]}],"out":[{"x":940,"y":220,"wires":[{"id":"a6eb88c4.19c058","port":0}]}]},{"id":"e1fcddda.49088","type":"subflow","name":"For Each 1BetPro Event","info":"","in":[{"x":200,"y":440,"wires":[{"id":"bf3db1de.5b3f8"}]}],"out":[{"x":1100,"y":440,"wires":[{"id":"16740cbc.486703","port":0}]}]},{"id":"381da27a.bf1b8e","type":"subflow","name":"Session Expired","info":"","in":[{"x":200,"y":220,"wires":[{"id":"f73f710.d3a749"}]}],"out":[{"x":1160,"y":220,"wires":[{"id":"20fb1a9c.949976","port":0}]}]},{"id":"920d75bc.d0fe08","type":"subflow","name":"Pinibet","info":"","in":[{"x":80,"y":280,"wires":[{"id":"e3369fff.039ef"}]}],"out":[{"x":4960,"y":320,"wires":[{"id":"357574e0.a4e85c","port":0}]},{"x":560,"y":200,"wires":[{"id":"cdbe34b2.cba798","port":0}]}]},{"id":"363f279c.1671a8","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","verifyservercert":false},{"id":"43749542.37d54c","type":"remote-server","z":"","name":"elastic","host":"http://elasticsearch-elasticsearch.default.svc.cluster.local:9200"},{"id":"c0e67585.074708","type":"kafka-broker","z":"","broker":"kafka-kafka.default.svc.cluster.local:9092","clientid":"node-red-2"},{"id":"17bb932a.0660ad","type":"redis-config","z":"dd2ff415.75e098","host":"redis-redis-ha.default.svc.cluster.local","port":"6379","dbase":"0","pass":""},{"id":"3535b384.5d390c","type":"redis-config","z":"","host":"10.63.252.6","port":"6379","dbase":"0","pass":"8xKI0onpl5"},{"id":"3c5b23c9.6f8d1c","type":"function","z":"faf2e075.8588c","name":"Go To Page and Listen","func":"'use strict';\n\nvar DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n    \nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nconst puppeteer = global.get('puppeteer');\n\n(async() => {\n            \n    const browser = await puppeteer.launch({args: ['--no-sandbox', '--disable-setuid-sandbox', '--shm-size=1gb', '--disable-dev-shm-usage']});\n    let page = await browser.newPage();\n\n    try{\n  \n        log('Setting Session Cookies');\n        await page.setCookie(...msg.session.cookies);\n        \n        await page.on('response', response => {\n             if (response.url().includes(msg.page.listenTo[0]) && response.status()===200){\n                \n                //msg.headers = response.request().headers();\n                //msg.postData = response.request().postData();\n                \n                response.json().then(function (json) {\n                    \n                    msg.topic = 'RESPONSE_FROM_' + response.url();\n                    msg.payload = json;\n                    \n                    node.send(msg);\n        \n                    log(msg.page.website.name + ' -- Sending a ' + msg.topic + ' message');\n                    \n                    log(msg.page.website.name + ' -- Finish Closing browser...');\n        \n                    browser.close();\n        \n                    log(msg.page.website.name + ' -- Goodbye!!');\n                })\n                \n            }\n        });\n\n        log('Go to page ' + msg.page.url);\n        await page.goto(msg.page.url);\n\n        log(msg.page.website.name + ' -- Wait For Selector ' + msg.page.waitForSelector + ' ...')\n        await page.waitForSelector(msg.page.waitForSelector,{timeout : 10000});\n        //await page.waitForNavigation({waitUntil: 'load'});\n        \n        const url = await page.evaluate(() => location.href);\n        \n        await msg.session.history.push({\n            url: url,\n            timestamp: Date.now()\n        });\n        \n        log(msg.page.website.name + ' -- Waiting ' + (msg.page.waitFor/1000) + ' seconds for responses before closing browser');\n        await sleep(msg.page.waitFor);\n        \n        log(msg.page.website.name + ' -- Timeout Closing browser...');\n        \n        await page.close();\n        await browser.close();\n        \n        log(msg.page.website.name + ' -- Goodbye!!');\n    }\n    catch(e){\n        node.error(e);\n        \n        log(msg.page.website.name + ' -- Closing browser...');\n        \n        await browser.close();\n        \n        log(msg.page.website.name + ' -- Goodbye!!');\n        \n        await page.close();\n        await browser.close();\n        \n        //return msg;\n    }\n})();","outputs":1,"noerr":0,"x":860,"y":320,"wires":[["ca4ed912.eec118"]]},{"id":"f33e6a44.9207c8","type":"function","z":"d94fb931.bab888","name":"Login","func":"'use strict';\n\nvar DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n    \nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n    \nconst puppeteer = global.get('puppeteer');\n\n(async() => {\n    \n    const browser = await puppeteer.launch({args: ['--no-sandbox', '--disable-setuid-sandbox', '--shm-size=1gb', '--disable-dev-shm-usage']});\n    let page = await browser.newPage();\n  \n    try{\n        \n        log(msg.website.name + ' -- Go to 1BetPro Website');\n        await page.goto('https://1betpro.com/');\n\n        log(msg.website.name + ' -- Type the login information :' + JSON.stringify(msg.website.params));\n        await page.type('#form > div:nth-child(2) > input', msg.website.params.username);\n        await page.type('#form > div:nth-child(3) > input', msg.website.params.password);\n\n        await page.waitForSelector('#form > input',{timeout : 5000});\n\n        log(msg.website.name + ' -- Login')\n        await page.click('#form > input');\n        \n        log(msg.website.name + ' -- Wait till change format manu visible')\n        await page.waitForSelector('a.oddsChanges.borderBox.withoutTopBorder',{timeout : 10000});\n        \n        log(msg.website.name + ' -- Logged In, saving cookies')\n        //msg.website.cookies = await page.cookies()\n        \n        await page.evaluate(() => {\n            getjson({odds:\"e\"},function(data){document.location.reload();});\n        });\n\n        await page.waitForNavigation();\n        \n        const cookies = await page.cookies()\n        \n        const url = await page.evaluate(() => location.href);\n     \n        msg.website.session ={\n            cookies: cookies,\n            history: []\n        }\n        \n        await msg.website.session.history.push({\n            url: url,\n            timestamp: Date.now()\n        });\n        \n        msg.payload =[msg.website.name + \"_session\",JSON.stringify(msg.website.session)]\n\n        msg.topic = 'LOGIN_SUCCESS';\n        \n        node.send(msg);\n        \n        log(msg.website.name + ' -- Sending a ' + msg.topic + ' message');\n        await page.close();\n        await browser.close();\n    }\n    catch(e){\n        \n        node.error(e);\n        \n        msg.topic = 'LOGIN_FAILED';\n        \n        node.send(msg);\n        \n        log(msg.website.name + ' -- Sending a ' + msg.topic + ' message');\n        \n        await page.close();\n        await browser.close();\n    }\n})();","outputs":1,"noerr":0,"x":830,"y":80,"wires":[["a7be1e21.862a5"]]},{"id":"1528693d.0811d7","type":"change","z":"bda9989.3a98068","name":"Set Pages","rules":[{"t":"set","p":"payload","pt":"msg","to":"website.pages","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":160,"wires":[["3e8df435.17460c"]]},{"id":"3e8df435.17460c","type":"split","z":"bda9989.3a98068","name":"For Each Page","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":560,"y":160,"wires":[["e10998cc.96ab38"]]},{"id":"eba2bf23.6eece","type":"change","z":"8d7750f6.a91db","name":"Set Line","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.line","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":240,"wires":[["de22efe5.6e2f4"]]},{"id":"8271efd5.73b9","type":"switch","z":"8d7750f6.a91db","name":"Got Line","property":"payload.line","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":240,"wires":[["eba2bf23.6eece"]]},{"id":"de22efe5.6e2f4","type":"split","z":"8d7750f6.a91db","name":"For Each Line","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":820,"y":240,"wires":[[]]},{"id":"5c4c5c17.9aa634","type":"html","z":"fd5c9c45.e7c55","name":"Games","property":"payload.html","tag":".addbetslip","ret":"attr","as":"single","x":660,"y":200,"wires":[["d51a1b5b.e97b98"]]},{"id":"37567a71.92f186","type":"change","z":"fd5c9c45.e7c55","name":"Set Game ID","rules":[{"t":"set","p":"payload","pt":"msg","to":"$split(msg.payload.html[0].id, \"_\", 1)[0]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":200,"wires":[["a2a014fd.7e5dc8"]]},{"id":"7fc302c0.bf813c","type":"join","z":"fd5c9c45.e7c55","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":1310,"y":200,"wires":[["84f6d07e.16321"]]},{"id":"d51a1b5b.e97b98","type":"switch","z":"fd5c9c45.e7c55","name":"","property":"payload.html[0]","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":790,"y":200,"wires":[["37567a71.92f186"]]},{"id":"e842ceac.82bd7","type":"split","z":"520d204a.6248b","name":"For Each Game","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":660,"y":220,"wires":[["a3477e2e.5793b"]]},{"id":"a3477e2e.5793b","type":"delay","z":"520d204a.6248b","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":840,"y":220,"wires":[["fb3d627c.b4bff"]]},{"id":"9edd3745.df21f8","type":"change","z":"52f2656a.61247c","name":"Set Game Data","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.origin","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":440,"wires":[["2ee2b01d.82be"]]},{"id":"2ee2b01d.82be","type":"split","z":"52f2656a.61247c","name":"For Each Game","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":360,"y":440,"wires":[["d154070c.4ac2f8"]]},{"id":"d154070c.4ac2f8","type":"switch","z":"52f2656a.61247c","name":"","property":"payload.types","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":510,"y":440,"wires":[["94fbb25e.c4de7"]]},{"id":"94fbb25e.c4de7","type":"change","z":"52f2656a.61247c","name":"Set Types","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.types","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":440,"wires":[["835b0a86.fee6a8"]]},{"id":"835b0a86.fee6a8","type":"split","z":"52f2656a.61247c","name":"For Each Type","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":800,"y":440,"wires":[["227433d4.fe887c"]]},{"id":"227433d4.fe887c","type":"change","z":"52f2656a.61247c","name":"Set Games","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.games","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":440,"wires":[[]]},{"id":"748372d2.415cec","type":"function","z":"52f2656a.61247c","name":"","func":"var DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n\nDate.prototype.getRoundHours = function() {\n  var mm = this.getMonth() + 1; // getMonth() is zero-based\n  var dd = this.getDate();\n  \n  return [this.getFullYear()     + '-',\n          (mm>9 ? '' : '0') + mm + '-',\n          (dd>9 ? '' : '0') + dd ,\n         ].join('');\n};\n\nlet odds = [];\n\ntry{\n    \n    let event_date = new Date();\n    let event_rounded_date = event_date.getRoundHours();\n\n    let event_hour = msg.data.date.replace('<span class=\"tablo_time\">','').replace('</span>','');\n    \n    event_date = new Date(event_rounded_date.toString() + ' ' + event_hour + \":00\");\n    \nlet event = {\n    \"name\" : (msg.data.teams[0] + ' vs ' + msg.data.teams[1]).toLowerCase(),\n    \"official\": (msg.google.result.length>0) ? msg.google.result[0].toLowerCase() : (msg.data.teams[0] + ' vs ' + msg.data.teams[1]).toLowerCase(),\n    \"participants\" : msg.data.teams.map(team => {return team.toLowerCase()}),\n    \"date\" : event_date.getTime(),\n    \"score\" : (msg.data.hasOwnProperty(\"add_inf\")) ? ((msg.data.add_inf.hasOwnProperty(\"sc1\")) ? msg.data.add_inf.sc1 : 0) + ' - ' + ((msg.data.add_inf.hasOwnProperty(\"sc2\")) ? msg.data.add_inf.sc2 : 0) : '0 - 0',\n    \"league.name\" : msg.data.league.toLowerCase(),\n    \"sport.name\" : msg.data.sport.toLowerCase(),\n    \"minute\": (msg.data.hasOwnProperty(\"add_inf\")) ? parseInt(msg.data.add_inf.minute.replace(\"'\")) : 0\n}\n\nlet orig_odds = msg.data.sg[\"1\"];\n\nif(orig_odds.hasOwnProperty(\"ft\")){\n    \n    if(orig_odds.ft.hasOwnProperty(\"1x2\")){\n            \n        odds.push({\n            \"event\" : event,\n            \"odd\": {\n                \"1betpro.id\" : orig_odds.ft[\"1x2\"][0][0].replace(\"__\",\"\"),\n                \"type\" : \"1x2\",\n                \"expires_on\" : \"Full Time\",\n                \"1betpro.money_line\"  : parseFloat(orig_odds.ft[\"1x2\"][0][1]),\n                \"run_line\" : 1,\n                \"opponent\": 1\n            }\n        });\n    \n        odds.push({\n            \"event\" : event,\n            \"odd\": {\n                \n                \"1betpro.id\" : orig_odds.ft[\"1x2\"][1][0].replace(\"__\",\"\"),\n                \"type\" : \"1x2\",\n                \"expires_on\" : \"Full Time\",\n                \"1betpro.money_line\"  : parseFloat(orig_odds.ft[\"1x2\"][1][1]),\n                \"run_line\" : 1,\n                \"opponent\": 2\n            }\n        });\n        \n        odds.push({\n            \"event\" : event,\n            \"odd\": {\n                \n                \"1betpro.id\" : orig_odds.ft[\"1x2\"][2][0].replace(\"__\",\"\"),\n                \"type\" : \"1x2\",\n                \"expires_on\" : \"Full Time\",\n                \"1betpro.money_line\"  : parseFloat(orig_odds.ft[\"1x2\"][2][1]),\n                \"run_line\" : 1,\n                \"opponent\": 0\n            }\n        });\n    }\n    \n    if(orig_odds.ft.hasOwnProperty(\"ou\")){\n        orig_odds.ft.ou.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \n                    \"1betpro.id\" : odd[0][0].replace(\"__\",\"\"),\n                    \"type\" : \"Over\",\n                    \"expires_on\" : \"Full Time\",\n                    \"1betpro.money_line\"  : parseFloat(odd[0][1]),\n                    \"run_line\"  : parseFloat((odd[0][2]==\"pk\") ? 0 : odd[0][2]),\n                    \"opponent\": 1\n                }\n            });\n        \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \n                    \"1betpro.id\" : odd[1][0].replace(\"__\",\"\"),\n                    \"type\" : \"Under\",\n                    \"expires_on\" : \"Full Time\",\n                    \"1betpro.money_line\"  : parseFloat(odd[1][1]),\n                    \"run_line\"  : parseFloat((odd[1][2]==\"pk\") ? 0 : odd[1][2]),\n                    \"opponent\": 2\n                }\n            });\n        })\n        \n    }\n    \n    if(orig_odds.ft.hasOwnProperty(\"ah\")){\n        orig_odds.ft.ah.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \n                    \"1betpro.id\" : odd[0][0].replace(\"__\",\"\"),\n                    \"type\" : \"Handicap\",\n                    \"expires_on\" : \"Full Time\",\n                    \"1betpro.money_line\"  : parseFloat(odd[0][1]),\n                    \"run_line\"  : parseFloat((odd[0][2]==\"pk\") ? 0 : odd[0][2]),\n                    \"opponent\": 1\n                }\n            });\n        \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \n                    \"1betpro.id\" : odd[1][0].replace(\"__\",\"\"),\n                    \"type\" : \"Handicap\",\n                    \"expires_on\" : \"Full Time\",\n                    \"1betpro.money_line\"  : parseFloat(odd[1][1]),\n                    \"run_line\"  : parseFloat((odd[1][2]==\"pk\") ? 0 : odd[1][2]),\n                    \"opponent\": 2\n                }\n            });\n        })\n        \n    }\n}\n\nif(orig_odds.hasOwnProperty(\"ht\")){\n    \n    if(orig_odds.ht.hasOwnProperty(\"1x2\")){\n        odds.push({\n            \"event\" : event,\n            \"odd\": {\n                \n                \"1betpro.id\" : orig_odds.ht[\"1x2\"][0][0].replace(\"__\",\"\"),\n                \"type\" : \"1x2\",\n                \"expires_on\" : \"1st Half\",\n                \"1betpro.money_line\"  : parseFloat(orig_odds.ht[\"1x2\"][0][1]),\n                \"run_line\" : 1,\n                \"opponent\": 1\n            }\n        });\n    \n        odds.push({\n            \"event\" : event,\n            \"odd\": {\n                \n                \"1betpro.id\" : orig_odds.ht[\"1x2\"][1][0].replace(\"__\",\"\"),\n                \"type\" : \"1x2\",\n                \"expires_on\" : \"1st Half\",\n                \"1betpro.money_line\"  : parseFloat(orig_odds.ht[\"1x2\"][1][1]),\n                \"run_line\" : 1,\n                \"opponent\": 2\n            }\n        });\n        \n        odds.push({\n            \"event\" : event,\n            \"odd\": {\n                \n                \"1betpro.id\" : orig_odds.ht[\"1x2\"][2][0].replace(\"__\",\"\"),\n                \"type\" : \"1x2\",\n                \"expires_on\" : \"1st Half\",\n                \"1betpro.money_line\"  : parseFloat(orig_odds.ht[\"1x2\"][2][1]),\n                \"run_line\" : 1,\n                \"opponent\": 0\n            }\n        });\n    }\n    \n    if(orig_odds.ht.hasOwnProperty(\"ou\")){\n        orig_odds.ht.ou.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \n                    \"1betpro.id\" : odd[0][0].replace(\"__\",\"\"),\n                    \"type\" : \"Over\",\n                    \"expires_on\" : \"1st Half\",\n                    \"1betpro.money_line\"  : parseFloat(odd[0][1]),\n                    \"run_line\"  : parseFloat((odd[0][2]==\"pk\") ? 0 : odd[0][2]),\n                    \"opponent\": 1\n                }\n            });\n        \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \n                    \"1betpro.id\" : odd[1][0].replace(\"__\",\"\"),\n                    \"type\" : \"Under\",\n                    \"expires_on\" : \"1st Half\",\n                    \"1betpro.money_line\"  : parseFloat(odd[1][1]),\n                    \"run_line\"  : parseFloat((odd[1][2]==\"pk\") ? 0 : odd[1][2]),\n                    \"opponent\": 2\n                }\n            });\n        })\n        \n    }\n    \n    if(orig_odds.ht.hasOwnProperty(\"ah\")){\n        orig_odds.ht.ah.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \n                    \"1betpro.id\" : odd[0][0].replace(\"__\",\"\"),\n                    \"type\" : \"Handicap\",\n                    \"expires_on\" : \"1st Half\",\n                    \"1betpro.money_line\"  : parseFloat(odd[0][1]),\n                    \"run_line\"  : parseFloat((odd[0][2]==\"pk\") ? 0 : odd[0][2]),\n                    \"opponent\": 1\n                }\n            });\n        \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \n                    \"1betpro.id\" : odd[1][0].replace(\"__\",\"\"),\n                    \"type\" : \"Handicap\",\n                    \"expires_on\" : \"1st Half\",\n                    \"1betpro.money_line\"  : parseFloat(odd[1][1]),\n                    \"run_line\"  : parseFloat((odd[1][2]==\"pk\") ? 0 : odd[1][2]),\n                    \"opponent\": 2\n                }\n            });\n        })\n        \n    }\n}\n\n//log(msg.page.website.name + ' -- Finish Transformation, got ' + odds.length + ' rows');\n\n/*odds = odds.map(odd => {\n    Object.keys(odd).map(function(key, index) {\n       odd[key] = (odd[key]===null || odd[key]===undefined) ? \"-1\" : odd[key];\n    });\n})*/\n}\ncatch(e){\n    //node.error(e);\n    msg.error = e;\n}\n\nmsg.payload = odds;\n\nreturn msg;","outputs":1,"noerr":0,"x":130,"y":280,"wires":[[]]},{"id":"9f5860af.d57d4","type":"split","z":"52f2656a.61247c","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":270,"y":280,"wires":[["58691bd5.d808c4"]]},{"id":"7cbb4217.a0db0c","type":"switch","z":"29cf43c4.26adec","name":"Yes/No","property":"exists","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":680,"y":280,"wires":[["7403b2ec.c6c45c"],["ac24189d.f354c8"]]},{"id":"776d9b53.b4dba4","type":"change","z":"6ca7ba6a.fb6f14","name":"Set Websites","rules":[{"t":"set","p":"payload","pt":"msg","to":"data.websites","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":190,"y":140,"wires":[["8ddae01b.66ca2"]]},{"id":"8ddae01b.66ca2","type":"split","z":"6ca7ba6a.fb6f14","name":"For Each Website","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":370,"y":140,"wires":[["f312958f.97f068"]]},{"id":"f312958f.97f068","type":"change","z":"6ca7ba6a.fb6f14","name":"Set Website","rules":[{"t":"set","p":"website","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":140,"wires":[["d7e13ed0.a2355"]]},{"id":"d7e13ed0.a2355","type":"switch","z":"6ca7ba6a.fb6f14","name":"Route by website","property":"website.name","propertyType":"msg","rules":[{"t":"eq","v":"1betpro.com","vt":"str"},{"t":"eq","v":"966sport.com--disabled","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":730,"y":140,"wires":[[],[]]},{"id":"fb3d627c.b4bff","type":"change","z":"520d204a.6248b","name":"Set Game Page","rules":[{"t":"set","p":"page","pt":"msg","to":"{\t    \"url\": msg.website.url & msg.payload & '/game/',\t    \"waitFor\": msg.website.waitFor,\t    \"waitForSelector\": msg.payload.waitForSelector,\t    \"listenTo\": msg.website.listenTo,\t    \"website\":{\"name\": msg.website.name}\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":220,"wires":[[]]},{"id":"a65dba6.f920e48","type":"change","z":"bda9989.3a98068","name":"Set Page URL","rules":[{"t":"set","p":"page","pt":"msg","to":"{\t    \"url\": msg.website.url & msg.payload.url,\t    \"waitFor\": msg.payload.waitFor,\t    \"waitForSelector\": msg.payload.waitForSelector,\t    \"listenTo\": msg.payload.listenTo,\t    \"website\":{\"name\": msg.website.name}\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":160,"wires":[[]]},{"id":"476c9431.c9e18c","type":"template","z":"29cf43c4.26adec","name":"Query","field":"query","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n  \"query\": {\n    \"bool\": {\n      \"should\": [\n        { \"match\": { \"event.date\":  {\"query\": \"{{payload.event.date}}\"} }},\n        { \"match\": { \"odd.type\": {\"query\": \"{{payload.odd.type}}\"}}},\n        { \"match\": { \"odd.expires_on\": {\"query\": \"{{payload.odd.expires_on}}\"}}},\n        { \"match\": { \"odd.opponent\": {\"query\": \"{{payload.odd.opponent}}\"}}}\n      ]\n    }\n  }\n}","output":"str","x":910,"y":160,"wires":[["78dcc27.5dc073c"]]},{"id":"78dcc27.5dc073c","type":"es-search","z":"29cf43c4.26adec","name":"","documentIndex":"","documentType":"","query":"","sort":"","includeFields":"","maxResults":10,"server":"43749542.37d54c","x":1130,"y":160,"wires":[[]]},{"id":"3bab49a3.43e396","type":"es-exists","z":"29cf43c4.26adec","name":"","documentId":"","documentIndex":"","documentType":"","server":"43749542.37d54c","x":490,"y":280,"wires":[["7cbb4217.a0db0c"]]},{"id":"7403b2ec.c6c45c","type":"es-create","z":"29cf43c4.26adec","name":"","documentIndex":"","documentType":"","server":"43749542.37d54c","x":930,"y":240,"wires":[["d0f85fd9.2da0d"]]},{"id":"ac24189d.f354c8","type":"es-update","z":"29cf43c4.26adec","name":"","documentId":"","documentIndex":"","documentType":"","server":"43749542.37d54c","x":930,"y":320,"wires":[["fa556f64.980fd"]]},{"id":"aae7b2d0.d6d16","type":"function","z":"29cf43c4.26adec","name":"Debug","func":"var DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n\nlog('Checking if document ' + msg.documentId + ' already exists');\n\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":280,"wires":[["3bab49a3.43e396"]]},{"id":"fa556f64.980fd","type":"function","z":"29cf43c4.26adec","name":"Debug","func":"var DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n\nlog('Updating document ' + msg.documentId);\n//log('msg = ' + JSON.stringify(msg));\n\nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":320,"wires":[[]]},{"id":"d0f85fd9.2da0d","type":"function","z":"29cf43c4.26adec","name":"Debug","func":"var DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n\nlog('Creating document ' + msg.documentId);\n//log('msg = ' + JSON.stringify(msg));\nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":240,"wires":[[]]},{"id":"463f84ea.2a9dbc","type":"delay","z":"29cf43c4.26adec","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"10","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":180,"y":280,"wires":[["aae7b2d0.d6d16"]]},{"id":"a2a014fd.7e5dc8","type":"function","z":"fd5c9c45.e7c55","name":"Set Message Complete","func":"if(msg.parts.index === msg.parts.count-1) msg.complete = true;\n\nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":200,"wires":[["7fc302c0.bf813c"]]},{"id":"e10998cc.96ab38","type":"switch","z":"bda9989.3a98068","name":"Is Enabled?","property":"payload.enabled","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":160,"wires":[["a65dba6.f920e48"]]},{"id":"84f6d07e.16321","type":"function","z":"fd5c9c45.e7c55","name":"Debug","func":"if(msg.debug){\n    arr = [];\n    arr.push(msg.payload[0]);\n    msg.payload = arr;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":200,"wires":[[]]},{"id":"ded7f12b.b1d18","type":"rdkafka out","z":"aca500a5.26ea7","name":"Kafka","topic":"","key":"","partition":"0","broker":"c0e67585.074708","x":1630,"y":380,"wires":[]},{"id":"f7c26d47.9abfe","type":"inject","z":"aca500a5.26ea7","name":"","topic":"","payload":"","payloadType":"date","repeat":"120","crontab":"","once":false,"onceDelay":"3","x":190,"y":380,"wires":[["7da70950.cdd028"]]},{"id":"7da70950.cdd028","type":"change","z":"aca500a5.26ea7","name":"Set Websites","rules":[{"t":"set","p":"payload","pt":"msg","to":"data.websites","tot":"flow"},{"t":"set","p":"flow","pt":"msg","to":"data.name","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":380,"wires":[["78e2896d.f22e38","bc2637ed.e51ce8","65f76839.510bd8"]]},{"id":"65f76839.510bd8","type":"split","z":"aca500a5.26ea7","name":"For Each Website","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":670,"y":380,"wires":[["4949ef11.8c9d5"]]},{"id":"cb3489b8.e8d988","type":"change","z":"aca500a5.26ea7","name":"Set topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"msg.flow & '-' & msg.payload.name","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":380,"wires":[["f721cae3.107988","87cc6828.3edc08","ad112b19.1a9178"]]},{"id":"263e737e.a26f4c","type":"config","z":"aca500a5.26ea7","name":"data","properties":[{"p":"data","pt":"flow","to":"{\"debug\":false,\"name\":\"albert\",\"websites\":[{\"name\":\"1betpro\",\"enabled\":true,\"url\":\"https://1betpro.com/\",\"params\":{\"username\":\"Tal1234\",\"password\":\"1111\"},\"waitFor\":10000,\"listenTo\":[\"/ajax/\"],\"waitForSelector\":\"#logout_user\",\"pages\":[{\"url\":\"all/games/\",\"enabled\":false,\"waitFor\":10000,\"waitForSelector\":\"#logout_user\",\"listenTo\":[\"/ajax/\"]},{\"url\":\"live/\",\"enabled\":false,\"waitFor\":120000,\"waitForSelector\":\"#logout_user\",\"listenTo\":[\"/ajax/\"]}]},{\"name\":\"966sport\",\"enabled\":true,\"url\":\"http://966sport.com/\",\"params\":{\"username\":\"X222\",\"password\":\"12345\"},\"waitFor\":10000,\"listenTo\":[\"ajax/live?\"],\"waitForSelector\":\".b-user.open-button.left\",\"pages\":[{\"url\":\"live\",\"enabled\":true,\"waitFor\":120000,\"waitForSelector\":\".b-user.open-button.left\",\"listenTo\":[\"ajax/live?\"]},{\"url\":\"early.php?parm=zGxf8QREKexNOFpjiWAel3rpFnzZVa1mW0LGFqa6Gl4KMZTMAmnXh9dtHeuA3zb2PYsyrCrNoaqahwn%2BHovof5Xsg4szsy7cIGQhHUpM8rqkCFPq4HuOyAx6Scxm1Wq2\",\"enabled\":false,\"waitFor\":10000,\"waitForSelector\":\".b-user.open-button.left\",\"listenTo\":[\"ajax_t_games\"]},{\"url\":\"t_games?parm=EMyvDHrx3U4qVsrP%2BZ3e1GokOria%2BsQHIk%2BlX6LVy3mQcSbumzJVg9BM1YUxfLc%2FShx5BDz833LJWPMgA01ttA%3D%3D\",\"enabled\":false,\"waitFor\":10000,\"waitForSelector\":\".b-user.open-button.left\",\"listenTo\":[\"ajax_t_games\"]},{\"url\":\"early.php?parm=zGxf8QREKexNOFpjiWAel3rpFnzZVa1mW0LGFqa6Gl4KMZTMAmnXh9dtHeuA3zb2PYsyrCrNoaqahwn%2BHovof6nCz8aTXb7u2ScNs9QCOpT0SpGbCnQlrLq9nYJ2YHtw\",\"enabled\":false,\"waitFor\":10000,\"waitForSelector\":\".b-user.open-button.left\",\"listenTo\":[\"ajax_t_games\"]},{\"url\":\"early.php?parm=zGxf8QREKexNOFpjiWAel3rpFnzZVa1mW0LGFqa6Gl4KMZTMAmnXh9dtHeuA3zb2PYsyrCrNoaqahwn%2BHovof8LxzNw3KKAjZJFYTWgFhzKe3zwCQdTHu0U2bS3adN6Q\",\"enabled\":false,\"waitFor\":10000,\"waitForSelector\":\".b-user.open-button.left\",\"listenTo\":[\"ajax_t_games\"]}]},{\"name\":\"pinibet\",\"enabled\":true,\"url\":\"https://ropinwev.pinbet88.com/sports-service/sv/odds/events\",\"params\":{\"username\":\"avigershon\",\"password\":\"lioran020\"},\"waitFor\":10000,\"waitForSelector\":\"i.fa.icon.refresh\",\"pages\":[{\"url\":\"/sports-service/sv/odds/events\",\"enabled\":false,\"waitFor\":10000,\"waitForSelector\":\"i.fa.icon.refresh\"}]}]}","tot":"json"}],"active":true,"x":190,"y":200,"wires":[]},{"id":"f721cae3.107988","type":"json","z":"aca500a5.26ea7","name":"","property":"payload","action":"str","pretty":false,"x":1390,"y":380,"wires":[["ded7f12b.b1d18","4e3fd979.567268","a08741b9.d0c0a"]]},{"id":"3183b6e9.8de4ea","type":"change","z":"aca500a5.26ea7","name":"Set Common Params","rules":[{"t":"set","p":"payload.debug","pt":"msg","to":"debug","tot":"flow"},{"t":"set","p":"payload.flow","pt":"msg","to":"flow","tot":"msg"},{"t":"set","p":"payload.delay","pt":"msg","to":"delay","tot":"flow"},{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":380,"wires":[["cb3489b8.e8d988","7f46ebe0.6fed64","89599c12.06321"]]},{"id":"ad112b19.1a9178","type":"debug","z":"aca500a5.26ea7","name":"","active":false,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","x":1390,"y":440,"wires":[]},{"id":"5a2c3743.742b08","type":"config","z":"aca500a5.26ea7","name":"debug","properties":[{"p":"debug","pt":"flow","to":"true","tot":"bool"}],"active":true,"x":390,"y":200,"wires":[]},{"id":"78e2896d.f22e38","type":"debug","z":"aca500a5.26ea7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":660,"y":320,"wires":[]},{"id":"ed71a195.4fc58","type":"debug","z":"aca500a5.26ea7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1040,"y":320,"wires":[]},{"id":"7f46ebe0.6fed64","type":"debug","z":"aca500a5.26ea7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1240,"y":320,"wires":[]},{"id":"87cc6828.3edc08","type":"debug","z":"aca500a5.26ea7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1400,"y":320,"wires":[]},{"id":"4e3fd979.567268","type":"debug","z":"aca500a5.26ea7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1600,"y":320,"wires":[]},{"id":"bc2637ed.e51ce8","type":"debug","z":"aca500a5.26ea7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":650,"y":440,"wires":[]},{"id":"4db3314d.976e4","type":"debug","z":"aca500a5.26ea7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1030,"y":440,"wires":[]},{"id":"89599c12.06321","type":"debug","z":"aca500a5.26ea7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1230,"y":440,"wires":[]},{"id":"a08741b9.d0c0a","type":"debug","z":"aca500a5.26ea7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1610,"y":440,"wires":[]},{"id":"8a088a21.50a928","type":"function","z":"b7eb2a5f.2481a8","name":"Login","func":"'use strict';\n\nvar DEBUG=msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n    \nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n    \nconst puppeteer = global.get('puppeteer');\n\n(async() => {\n    \n    const browser = await puppeteer.launch({args: ['--no-sandbox', '--disable-setuid-sandbox', '--shm-size=1gb', '--disable-dev-shm-usage']});\n    const page = await browser.newPage();\n    \n    try{\n        \n        log(msg.website.name + ' -- Go to Website');\n        await page.goto('http://www.966sport.com/login/');\n\n        log(msg.website.name + ' -- Type the login information for website :' + JSON.stringify(msg.website.params));\n        await page.type('#form > div:nth-child(2) > div > input', msg.website.params.username);\n        await page.type('#form > div:nth-child(3) > div > input', msg.website.params.password);\n\n        await page.waitForSelector('#form > div:nth-child(4) > div > button',{timeout : 5000});\n\n        log(msg.website.name + ' -- Login')\n        await page.click('#form > div:nth-child(4) > div > button');\n        \n        log(msg.website.name + ' -- Wait till logged in')\n        await page.waitForSelector('.b-user.open-button.left',{timeout : 10000});\n        \n        log(msg.website.name + ' -- Logged In, saving cookies')\n        const cookies = await page.cookies()\n        const url = await page.evaluate(() => location.href);\n        \n        msg.website.session ={\n            cookies: cookies,\n            history: []\n        }\n        \n        await msg.website.session.history.push({\n            url: url,\n            timestamp: Date.now()\n        });\n        \n        await page.goto('http://www.966sport.com/options.php?lang=1');\n        \n        log(msg.website.name + ' -- Wait till English is set')\n        await page.waitForSelector('span.b-language-flag img[alt=English]',{timeout : 10000});\n        \n        await page.goto('http://www.966sport.com/options.php?odds=1');\n        \n        log(msg.website.name + ' -- Wait till Decimal is set')\n        await page.waitForSelector(\"option[value='options.php?odds=1']:checked\",{timeout : 10000});\n        \n        \n        msg.payload =[msg.website.name + \"_session\",JSON.stringify(msg.website.session)]\n        \n        msg.topic = 'LOGIN_SUCCESS';\n        \n        node.send(msg);\n        \n        log(msg.website.name + ' -- Sending a ' + msg.topic + ' message');\n        await page.close()\n        await browser.close();\n    }\n    catch(e){\n        \n        node.error(e);\n        \n        msg.topic = 'LOGIN_FAILED';\n        \n        node.send(msg);\n        \n        log(msg.website.name + ' -- Sending a ' + msg.topic + ' message');\n        \n        await page.close()\n        await browser.close();\n    }\n})();","outputs":1,"noerr":0,"x":810,"y":220,"wires":[["62fe0d24.d84414"]]},{"id":"62fe0d24.d84414","type":"switch","z":"b7eb2a5f.2481a8","name":"Login Status","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"LOGIN_FAILED","vt":"str"},{"t":"eq","v":"LOGIN_SUCCESS","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":220,"wires":[[],["f6c6cfcb.de8af"]]},{"id":"4c200cfb.9e86b4","type":"split","z":"dd2ff415.75e098","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":330,"y":240,"wires":[["8c3672cd.acb0b"]]},{"id":"8fcfbf33.d6be8","type":"function","z":"dd2ff415.75e098","name":"Transform","func":"var DEBUG=msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n\nDate.prototype.getRoundHours = function() {\n  var mm = this.getMonth() + 1; // getMonth() is zero-based\n  var dd = this.getDate();\n  var hh = this.getHours();\n  \n  return [this.getFullYear()     + '-',\n          (mm>9 ? '' : '0') + mm + '-',\n          (dd>9 ? '' : '0') + dd + 'T',\n          (hh>9 ? '' : '0') + hh + ':00:00.000Z',\n         ].join('');\n};\n\nlet odds = [];\n\ntry{\n    \n    let event_date = new Date();\n    let event_rounded_date = event_date.getRoundHours();\n\n    let event_minute = parseInt(msg.data.date);\n    \n    if(msg.data.date.includes(\"LIVE\") || msg.data.date.includes(\"Half Time\")){\n        //event_date = event_rounded_date;\n        //event_minute = 0;\n    }\n    else if(event_minute>=0){\n        \n        event_date.setMinutes(event_date.getMinutes() - event_minute);\n        event_date.setMinutes(event_date.getMinutes() - (event_date.getMinutes() % 5));\n        \n        event_date.setSeconds(\"00\");\n        event_date.setMilliseconds(\"000\");\n        \n        event_minute = event_minute;\n    }\n    else{\n        event_date = \"1900-01-01T00:00:00.000Z\";\n        event_minute = -1;\n    }\n    \n    //event_date = event_date.toString().replace(\"T\",\" \").replace(\".000Z\",\"\");\n    \n    msg.data.score_h = isNaN(parseInt(msg.data.score_h)) ? 0 : parseInt(msg.data.score_h)\n    msg.data.score_a = isNaN(parseInt(msg.data.score_a)) ? 0 : parseInt(msg.data.score_a)\n    \n    const event= {\n            name: (msg.data.home_team + ' vs ' + msg.data.away_team).toLowerCase(),\n            official: msg.google.result.length>0 ? msg.google.result[0].toLowerCase() : (msg.data.home_team + ' vs ' + msg.data.away_team).toLowerCase(),\n            //date: event_date.getTime(),\n            participants: [msg.data.home_team.toLowerCase(),msg.data.away_team.toLowerCase()],\n            score: msg.data.score_h + ' - ' + msg.data.score_a,\n            //minute: event_minute,\n            league: {\n                name: msg.league.liga.toLowerCase()\n            },\n            sport: {\n                name: msg.league.sport.toLowerCase()\n            }\n        };\n     \n    // 1x2\n    // Full Time \n    if(msg.data.hasOwnProperty(\"FT_1X2_h\")){\n        try{\n            \n            odds.push({\n            \"event\" : event,\n            \"odd\": {\n                \"type\"                  :  \"1x2\",\n                \"expires_on\"            :  \"Full Time\",\n                \"opponent\"              :  1,\n                \"966sport.id\"           :  (msg.data.id_e + 'FT_1X2_h').trim().replace(\" \",\"\"),\n                \"966sport.money_line\"   :  parseFloat(msg.data.FT_1X2_h.toString().trim().replace(\" \",\"\")),\n                \"run_line\"     :  1\n                }\n            });\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    if(msg.data.hasOwnProperty(\"FT_1X2_a\")){\n        try{\n            \n            odds.push({\n            \"event\" : event,\n            \"odd\": {\n                    \"type\"                  :  \"1x2\",\n                    \"expires_on\"            :  \"Full Time\",\n                    \"opponent\"              :  2,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FT_1X2_a').trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FT_1X2_a.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  1\n                }\n            });\n                \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    if(msg.data.hasOwnProperty(\"FT_1X2_d\")){\n        try{\n            \n            odds.push({\n            \"event\" : event,\n            \"odd\": {\n                    \"type\"                  :  \"1x2\",\n                    \"expires_on\"            :  \"Full Time\",\n                    \"opponent\"              :  0,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FT_1X2_d').trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FT_1X2_d.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  1\n                }\n            })\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    // 1st Half\n    if(msg.data.hasOwnProperty(\"FH_1X2_h\")){\n        try{\n            \n             odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"1x2\",\n                    \"expires_on\"            :  \"1st Half\",\n                    \"opponent\"              :  1,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FH_1X2_h').trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FH_1X2_h.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  1\n                }\n            })\n                \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    if(msg.data.hasOwnProperty(\"FH_1X2_a\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"1x2\",\n                    \"expires_on\"            :  \"1st Half\",\n                    \"opponent\"              :  2,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FH_1X2_a').trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FH_1X2_a.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  1\n                }\n            })\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    if(msg.data.hasOwnProperty(\"FH_1X2_d\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    event                       :  event,\n                    \"type\"                  :  \"1x2\",\n                    \"expires_on\"            :  \"1st Half\",\n                    \"opponent\"              :  0,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FH_1X2_d').trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FH_1X2_d.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  1\n                }\n            });\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    // Handicap\n    // Full Time\n    if(msg.data.hasOwnProperty(\"FT_HDP_h\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"Handicap\",\n                    \"expires_on\"            :  \"Full Time\",\n                    \"opponent\"              :  1,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FT_HDP_h' + msg.data.FT_HDP_h_op).trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FT_HDP_h.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  parseFloat(msg.data.FT_HDP_h_op.toString().trim().replace(\" \",\"\"))\n                }\n            });\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    } \n    \n    if(msg.data.hasOwnProperty(\"FT_HDP_a\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"Handicap\",\n                    \"expires_on\"            :  \"Full Time\",\n                    \"opponent\"              :  2,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FT_HDP_a' + msg.data.FT_HDP_a_op).trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FT_HDP_a.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  parseFloat(msg.data.FT_HDP_a_op.toString().trim().replace(\" \",\"\"))\n                }\n            });\n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    // 1st Half\n    if(msg.data.hasOwnProperty(\"FH_HDP_h\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"Handicap\",\n                    \"expires_on\"            :  \"1st Half\",\n                    \"opponent\"              :  1,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FH_HDP_h' + msg.data.FH_HDP_h_op).trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FH_HDP_h.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  parseFloat(msg.data.FH_HDP_h_op.toString().trim().replace(\" \",\"\"))\n                }\n            })\n            \n        }\n        catch(e){\n            \n        }\n    }\n    \n    if(msg.data.hasOwnProperty(\"FH_HDP_a\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"Handicap\",\n                    \"expires_on\"            :  \"1st Half\",\n                    \"opponent\"              :  2,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FH_HDP_a' + msg.data.FH_HDP_a_op).trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FH_HDP_a.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  parseFloat(msg.data.FH_HDP_a_op.toString().trim().replace(\" \",\"\"))\n                }\n            })\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    // Over\n    // Full Time\n    if(msg.data.hasOwnProperty(\"FT_OU_o\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"Over\",\n                    \"expires_on\"            :  \"Full Time\",\n                    \"opponent\"              :  1,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FT_OU_o' + msg.data.FT_OU_o_op).trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FT_OU_o.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  parseFloat(msg.data.FT_OU_o_op.toString().trim().replace(\" \",\"\"))\n                }\n            })\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    // Over\n    // 1st Half \n    if(msg.data.hasOwnProperty(\"FH_OU_o\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"Over\",\n                    \"expires_on\"            :  \"1st Half\",\n                    \"opponent\"              :  1,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FH_OU_o' + msg.data.FH_OU_o_op).trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FH_OU_o.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  parseFloat(msg.data.FH_OU_o_op.toString().trim().replace(\" \",\"\"))\n                }\n            })\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    \n    // Under\n    // Full Time\n    if(msg.data.hasOwnProperty(\"FT_OU_u\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"Under\",\n                    \"expires_on\"            :  \"Full Time\",\n                    \"opponent\"              :  2,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FT_OU_u' + msg.data.FT_OU_u_op).trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FT_OU_u.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  parseFloat(msg.data.FT_OU_u_op.toString().trim().replace(\" \",\"\"))\n                }\n            })\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    // Under\n    // 1st Half \n    if(msg.data.hasOwnProperty(\"FH_OU_u\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": {\n                    \"type\"                  :  \"Under\",\n                    \"expires_on\"            :  \"1st Half\",\n                    \"opponent\"              :  2,\n                    \"966sport.id\"           :  (msg.data.id_e + 'FH_OU_u' + msg.data.FH_OU_u_op).trim().replace(\" \",\"\"),\n                    \"966sport.money_line\"   :  parseFloat(msg.data.FH_OU_u.toString().trim().replace(\" \",\"\")),\n                    \"run_line\"     :  parseFloat(msg.data.FH_OU_u_op.toString().trim().replace(\" \",\"\"))\n                }\n            })\n           \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    msg.payload = odds;\n    \n    return msg;\n}\ncatch(e){\n    //node.error(e)\n    \n    msg.payload = odds;\n    msg.error = e;\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":190,"y":240,"wires":[["4c200cfb.9e86b4"]]},{"id":"e53e4072.3e599","type":"function","z":"987d9c15.b3c5","name":"Google Session","func":"'use strict';\n\nvar DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n\nconst puppeteer = global.get('puppeteer');\n\n(async() => {\n    \n    const browser = await puppeteer.launch({args: ['--no-sandbox', '--disable-setuid-sandbox', '--shm-size=1gb', '--disable-dev-shm-usage']});\n    let page = await browser.newPage();\n  \n    let ip = \"0.0.0.0\";\n    \n    try{\n       \n        log('Google -- Search for my ip');\n\n        await page.goto('https://www.google.com/search?q=whats+my+ip');\n        \n        log('Google -- Wait For Selector');\n        \n        const resultsSelector = \"w-answer-desktop\";\n        \n        await page.waitForSelector(resultsSelector);\n\n        log('Google -- Get your ip');\n    \n        // Extract the results from the page.\n        const result = await page.evaluate(resultsSelector => {\n            const anchors = Array.from(document.querySelectorAll(resultsSelector));\n            return anchors.map(anchor => {\n                const ip = anchor.textContent.replace(\"Your public IP address\",\"\");\n                return `${ip}`;\n            });\n        }, resultsSelector);\n        \n        if(Array.isArray(result) && result.length>0){\n            ip = result[0];\n            log('Google -- Your ip is ' + ip);\n        }\n        \n        log('Google -- saving cookies')\n        const cookies = await page.cookies()\n        \n        log('Google -- getting current url')\n        const url = await page.evaluate(() => location.href);\n              \n        msg.google.session = {\n            ip: ip,\n            cookies: cookies,\n            timestamp: Date.now()\n        }\n        \n        msg.payload =[msg.google.key,JSON.stringify(msg.google.session)]\n        \n        msg.topic = 'GOOGLE_SESSION_CREATED';\n        \n        node.send(msg);\n        \n        log('Google -- Sending a ' + msg.topic + ' message');\n        \n        await page.close();\n        await browser.close();\n      \n    }\n    catch(e){\n        \n        await page.close();\n        await browser.close();\n        \n        node.error(e);\n    }\n})();","outputs":1,"noerr":0,"x":1340,"y":400,"wires":[["e2da90eb.65ac9"]]},{"id":"f4a50262.cb338","type":"redis-command","z":"987d9c15.b3c5","server":"3535b384.5d390c","command":"get","name":"","topic":"","x":360,"y":560,"wires":[["c0a9ab2.c592258"]]},{"id":"22342900.6fd068","type":"redis-command","z":"987d9c15.b3c5","server":"3535b384.5d390c","command":"set","name":"","topic":"","x":1800,"y":400,"wires":[["62e9bb1.bfe4c44"]]},{"id":"5dca098e.2c9958","type":"json","z":"987d9c15.b3c5","name":"","property":"payload","action":"","pretty":false,"x":930,"y":560,"wires":[["8d871f40.f1413"]]},{"id":"8d871f40.f1413","type":"switch","z":"987d9c15.b3c5","name":"Result Exists in cache?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"null","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":2970,"y":580,"wires":[["f03b0cb4.d79d8"],["d8890ab8.a55588"]]},{"id":"e2da90eb.65ac9","type":"switch","z":"987d9c15.b3c5","name":"GOOGLE_SESSION_CREATED","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"GOOGLE_SESSION_CREATED","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1580,"y":400,"wires":[["22342900.6fd068"]]},{"id":"62e9bb1.bfe4c44","type":"switch","z":"987d9c15.b3c5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1930,"y":400,"wires":[["48dee163.2e4ab"]]},{"id":"48dee163.2e4ab","type":"function","z":"987d9c15.b3c5","name":"Prepare Google Search Request","func":"msg.headers = {};\n\nmsg.headers['pragma'] = 'no-cache';\nmsg.headers['accept-language'] = 'en-US,en;q=0.9,es;q=0.8,sq;q=0.7,he;q=0.6';\nmsg.headers['upgrade-insecure-requests'] = '1'; \nmsg.headers['user-agent'] = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36';\nmsg.headers['x-chrome-uma-enabled'] = '1';\nmsg.headers['accept'] = 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8';\nmsg.headers['cache-control'] = 'no-cache';\nmsg.headers['authority'] = 'www.google.com' ;\nmsg.headers['referer'] = 'https://www.google.com/' ;\nmsg.headers['x-client-data'] = 'CIy2yQEIorbJAQj6nMoBCKmdygEIqKPKAQ==' ;\n\nmsg.headers['cookie'] = \"\";\n\nmsg.google.session.cookies.forEach( cookie => {\n    msg.headers['cookie'] = msg.headers['cookie'] + cookie.name + \"=\" + cookie.value +\";\"\n})\n\n//msg.headers['cookie'] = 'SID=1wUR2bBk007ka1qZ-LlCFTWV9ZPktj_8uOlaCTGsH_rryPGPsHOYMeutRMqP_WfTM8vFOQ.; HSID=A8Y4w06TlsDswwAeJ; SSID=AMrMKCFrEi1gxGnqe; APISID=IUzWNM9U7bPx3J4v/A_rOjznojC8ZHa0rk; SAPISID=tcwxRaHvpIGdGEQr/AheQN6D7POnGDLZTk; NID=126=oLfgQyzVYw2_gppcrUt1BlzHuZCRuIYPvZ-sOkODSnfde3SprDxuWN0VTU2HNPUfY4ZQ5jmJ7C2D75UiRLWHqyWs_ITsTrmWbC7OT2OlhB--8_innIlhdx-e4xofTnEnmIa2PwhR2PLlO_VlIvid7gD-ojM0vxtapcl-fXy53KMogNmdKaZmUhWfhU1f4e-l3Wily_DoZ2PsJkyvnYutDRk0roWKlnWyC9xHej6NlmEGyzPhwPXBoDUHKtfNsyii3YQmIlmlM1S1kHIMChhUURlqHtf_mtmnbc4ZRpKWnXAXESkwzaZIOk_7ynJsO1joetFLjjrGM9I9phuIPcPRkIvzlJHpUuR36JtxeC6Olu4kxJS9Gb3Or2uCX9FALTmJ4w4HkHJbZu6UK4eBgNXvN4RXOqYJXRfDsoAvUe_Yyg4H3Fbqtg; 1P_JAR=2018-03-30-00; DV=Q4AOKmzuVAREIPs_ZJY6ITCwfh1EJxae6kcv-tqp4AAAACAcuD9TMkTrsAAAAKCB8PQiUMTiNgAAAA';\n\nmsg.url = \"https://www.google.com/search?q=\" + msg.google.q.replace(\" \",\"+\");\n\nreturn msg;","outputs":1,"noerr":0,"x":2100,"y":480,"wires":[["149f14a9.e81d9b"]]},{"id":"149f14a9.e81d9b","type":"http request","z":"987d9c15.b3c5","name":"","method":"GET","ret":"txt","url":"","tls":"363f279c.1671a8","x":2330,"y":480,"wires":[["c11046c9.e9f1d8"]]},{"id":"e324edae.a0205","type":"html","z":"987d9c15.b3c5","name":"","property":"payload","tag":"div[data-hveid] > div > h3 > a","ret":"attr","as":"multi","x":2520,"y":380,"wires":[["96ccb471.a7ea18"]]},{"id":"58691bd5.d808c4","type":"change","z":"52f2656a.61247c","name":"","rules":[{"t":"set","p":"documentIndex","pt":"msg","to":"\"bets\" & \"-\" & $replace($split($now(), \"T\", 1) [0],\"-\",\".\")","tot":"jsonata"},{"t":"set","p":"documentType","pt":"msg","to":"doc","tot":"str"},{"t":"set","p":"documentId","pt":"msg","to":"$base64encode(msg.payload.event.official & ';' & msg.payload.odd.type & ';' & msg.payload.odd.expires_on & ';' & msg.payload.odd.run_line)","tot":"jsonata"},{"t":"set","p":"payload.timestamp","pt":"msg","to":"","tot":"date"},{"t":"set","p":"google","pt":"msg","to":"{\t    \"q\" : msg.payload.event.name,\t    \"key\": \"google_session_test3\"\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":280,"wires":[[]]},{"id":"4949ef11.8c9d5","type":"switch","z":"aca500a5.26ea7","name":"","property":"payload.enabled","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":850,"y":380,"wires":[["3183b6e9.8de4ea","ed71a195.4fc58","4db3314d.976e4"]]},{"id":"a2128ad1.29f588","type":"function","z":"faf2e075.8588c","name":"Prepare http Request","func":"msg.headers = {};\n\nmsg.headers['Accept-Language'] = 'en-US,en;q=0.9,es;q=0.8,sq;q=0.7,he;q=0.6' \nmsg.headers['User-Agent'] = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36' \nmsg.headers['Accept'] = 'application/json, text/javascript, */*; q=0.01' \nmsg.headers['Referer'] = 'http://www.966sport.com/live' \nmsg.headers['X-Requested-With'] = 'XMLHttpRequest' \nmsg.headers['Connection'] = 'keep-alive'\n\nmsg.headers['cookie'] = \"\";\n\nmsg.session.cookies.forEach( cookie => {\n    msg.headers['cookie'] = msg.headers['cookie'] + cookie.name + \"=\" + cookie.value +\";\"\n})\n\nmsg.url = \"http://www.966sport.com/ajax/live?selsport=all&_=\" + msg.timestamp;\n\nmsg.topic = \"966SPORT_HTTP_REQUEST_COMPLETED\";\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":220,"wires":[["b2469cd2.9f36e"]]},{"id":"b2469cd2.9f36e","type":"http request","z":"faf2e075.8588c","name":"","method":"GET","ret":"txt","url":"","tls":"363f279c.1671a8","x":730,"y":220,"wires":[[]]},{"id":"ca4ed912.eec118","type":"switch","z":"faf2e075.8588c","name":"Response","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"RESPONSE_FROM_","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1050,"y":320,"wires":[[]]},{"id":"90a915b4.cfd408","type":"function","z":"4831be77.6607b","name":"Prepare http Request","func":"msg.headers = {};\n\nmsg.headers['origin'] = 'https://1betpro.com' \nmsg.headers['accept-language'] = 'en-US,en;q=0.9,es;q=0.8,sq;q=0.7,he;q=0.6' \nmsg.headers['user-agent'] = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36' \nmsg.headers['content-type'] = 'application/x-www-form-urlencoded' \nmsg.headers['accept'] = 'application/json, text/javascript, */*; q=0.01' \nmsg.headers['referer'] = 'https://1betpro.com/live/' \nmsg.headers['authority'] = '1betpro.com' \nmsg.headers['x-requested-with'] = 'XMLHttpRequest' \n\nmsg.headers['cookie'] = \"\";\n\nmsg.session.cookies.forEach( cookie => {\n    msg.headers['cookie'] = msg.headers['cookie'] + cookie.name + \"=\" + cookie.value +\";\"\n})\n\nmsg.url = \"https://1betpro.com/ajax/\"\n\nmsg.payload = {\n    \"mode\" : \"sports_leagues\",\n    \"period\" : \"live\",\n    \"rnd\" : msg.timestamp,\n    \"human\" : 0,\n    \"delta_time\" : 2113\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":220,"wires":[["a6eb88c4.19c058"]]},{"id":"a6eb88c4.19c058","type":"http request","z":"4831be77.6607b","name":"","method":"GET","ret":"txt","url":"","tls":"363f279c.1671a8","x":790,"y":220,"wires":[[]]},{"id":"a3ffdf4e.7085b","type":"subflow:d94fb931.bab888","z":"72706932.2ca048","name":"1Betpro Session","x":880,"y":380,"wires":[["fb578d29.1ce7f","ddf94991.e5db28","423bf2e8.f1eafc"],["423bf2e8.f1eafc"]]},{"id":"22452de0.538f82","type":"subflow:fd5c9c45.e7c55","z":"72706932.2ca048","name":"","x":1940,"y":300,"wires":[["807d61ad.a771d","f2742064.23fa9","d67ed55f.025e88"]]},{"id":"3b2f8d91.8307b2","type":"json","z":"72706932.2ca048","name":"","property":"payload","action":"obj","pretty":false,"x":230,"y":540,"wires":[["7d64f751.58a0a8","9b033c6a.ff22f","f522eff1.97f54"]]},{"id":"423bf2e8.f1eafc","type":"debug","z":"72706932.2ca048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1110,"y":420,"wires":[]},{"id":"9bfe377e.616698","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1930,"y":340,"wires":[]},{"id":"807d61ad.a771d","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2130,"y":360,"wires":[]},{"id":"fb578d29.1ce7f","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1120,"y":280,"wires":[]},{"id":"990542a6.c5e6c","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1920,"y":240,"wires":[]},{"id":"f2742064.23fa9","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":2140,"y":240,"wires":[]},{"id":"bb2abe61.a0402","type":"subflow:52f2656a.61247c","z":"72706932.2ca048","name":"","x":2880,"y":300,"wires":[["bfd80ccb.b371c","42dbeb0f.fc3cf4","3f7b90cd.00658"]]},{"id":"e81d64b7.6032c8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":2380,"y":240,"wires":[]},{"id":"c5f3bb7c.f534c8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2370,"y":360,"wires":[]},{"id":"d3628d81.4bd6c","type":"debug","z":"72706932.2ca048","name":"post-save","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1300,"y":540,"wires":[]},{"id":"561b404f.4d0fd","type":"subflow:29cf43c4.26adec","z":"72706932.2ca048","name":"","x":880,"y":540,"wires":[["d3628d81.4bd6c","2f2a8afe.4143b6"],["d3628d81.4bd6c"],["d7b3cb7b.e48a78"]]},{"id":"d7b3cb7b.e48a78","type":"debug","z":"72706932.2ca048","name":"query result","active":false,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","x":1140,"y":580,"wires":[]},{"id":"2f2a8afe.4143b6","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1120,"y":480,"wires":[]},{"id":"35a6dd67.524e82","type":"switch","z":"72706932.2ca048","name":"Topic router","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"albert-1betpro","vt":"str"},{"t":"eq","v":"albert-1betpro-session-expired","vt":"str"},{"t":"eq","v":"albert-save-document","vt":"str"},{"t":"eq","v":"albert-966sport","vt":"str"},{"t":"eq","v":"albert-966sport-session-expired","vt":"str"},{"t":"eq","v":"albert-pinibet","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":650,"y":540,"wires":[["a3ffdf4e.7085b"],["a3ffdf4e.7085b"],["10a87057.1c8f2","561b404f.4d0fd","cd5febc9.816348"],["6d1a6a43.1f9b94"],["6d1a6a43.1f9b94"],["982e21d2.e9ce7","6c896591.4ceb4c"]]},{"id":"8ae4bf07.b9737","type":"rdkafka in","z":"72706932.2ca048","name":"","topic":"^albert-*","cgroup":"albert","autocommit":true,"broker":"c0e67585.074708","x":60,"y":540,"wires":[["51f05838.cc4ef8","4a71e3b5.f78e4c","3b2f8d91.8307b2"]]},{"id":"e6e3b9c3.9edc08","type":"debug","z":"72706932.2ca048","name":"Failed","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1110,"y":860,"wires":[]},{"id":"3dd79902.cfab06","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1120,"y":640,"wires":[]},{"id":"b1dcbc77.0a06e","type":"function","z":"72706932.2ca048","name":"Stringify Message","func":"\nmsg = {\n    documentIndex: msg.documentIndex,\n    documentType: msg.documentType,\n    documentId: msg.documentId,\n    payload: msg.payload,\n    debug: msg.debug,\n    flow: msg.flow\n}\n\nmsg.payload = JSON.stringify(msg);\nmsg.topic   = msg.flow + \"-save-document\";\n\nreturn msg;","outputs":1,"noerr":0,"x":3590,"y":700,"wires":[["79a4f0c6.b1a75"]]},{"id":"79a4f0c6.b1a75","type":"rdkafka out","z":"72706932.2ca048","name":"save-document","topic":"","key":"","partition":-1,"broker":"c0e67585.074708","x":3780,"y":700,"wires":[]},{"id":"71f4dcf7.bf9a14","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":3570,"y":740,"wires":[]},{"id":"51f05838.cc4ef8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":270,"y":640,"wires":[]},{"id":"4a71e3b5.f78e4c","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":280,"y":440,"wires":[]},{"id":"555968b1.b7e128","type":"delay","z":"72706932.2ca048","name":"Delay","pauseType":"delayv","timeout":"0","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":510,"y":540,"wires":[["35a6dd67.524e82"]]},{"id":"6d1a6a43.1f9b94","type":"subflow:b7eb2a5f.2481a8","z":"72706932.2ca048","name":"","x":900,"y":720,"wires":[["3dd79902.cfab06","e0434152.2f6db","14682161.4e2baf"],["e6e3b9c3.9edc08"]]},{"id":"2df3addd.761402","type":"subflow:dd2ff415.75e098","z":"72706932.2ca048","name":"","x":3370,"y":700,"wires":[["b1dcbc77.0a06e","71f4dcf7.bf9a14"]]},{"id":"890e7c96.dae9a","type":"subflow:987d9c15.b3c5","z":"72706932.2ca048","name":"","x":3120,"y":700,"wires":[["2df3addd.761402","5c5a456d.bdcc9c","8b5e8a2f.623cd8"]]},{"id":"fa6f23a9.c2e73","type":"function","z":"e1fcddda.49088","name":"Prepare http Request","func":"msg.headers = {};\n\nmsg.headers['origin'] = 'https://1betpro.com' \nmsg.headers['accept-language'] = 'en-US,en;q=0.9,es;q=0.8,sq;q=0.7,he;q=0.6' \nmsg.headers['user-agent'] = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36' \nmsg.headers['content-type'] = 'application/x-www-form-urlencoded' \nmsg.headers['accept'] = 'application/json, text/javascript, */*; q=0.01' \nmsg.headers['referer'] = 'https://1betpro.com/live/' \nmsg.headers['authority'] = '1betpro.com' \nmsg.headers['x-requested-with'] = 'XMLHttpRequest' \n\nmsg.headers['cookie'] = \"\";\n\nmsg.website.session.cookies.forEach( cookie => {\n    msg.headers['cookie'] = msg.headers['cookie'] + cookie.name + \"=\" + cookie.value +\";\"\n})\n\nmsg.url = \"https://1betpro.com/ajax/\"\n\nmsg.payload = {\n    \"mode\" : \"game_more\",\n    \"game_id\" : msg.payload,\n    \"rnd\" : new Date(),\n    \"human\" : 1,\n    \"delta_time\" : 0\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":440,"wires":[["dfb00517.1363e8"]]},{"id":"dfb00517.1363e8","type":"http request","z":"e1fcddda.49088","name":"","method":"POST","ret":"txt","url":"","tls":"363f279c.1671a8","x":830,"y":440,"wires":[["16740cbc.486703"]]},{"id":"ddf94991.e5db28","type":"function","z":"72706932.2ca048","name":"Prepare http Request","func":"msg.headers = {};\n\nmsg.headers['origin'] = 'https://1betpro.com' \nmsg.headers['accept-language'] = 'en-US,en;q=0.9,es;q=0.8,sq;q=0.7,he;q=0.6' \nmsg.headers['user-agent'] = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36' \nmsg.headers['content-type'] = 'application/x-www-form-urlencoded' \nmsg.headers['accept'] = 'application/json, text/javascript, */*; q=0.01' \nmsg.headers['referer'] = 'https://1betpro.com/live/' \nmsg.headers['authority'] = '1betpro.com' \nmsg.headers['x-requested-with'] = 'XMLHttpRequest' \n\nmsg.headers['cookie'] = \"\";\n\nmsg.website.session.cookies.forEach( cookie => {\n    msg.headers['cookie'] = msg.headers['cookie'] + cookie.name + \"=\" + cookie.value +\";\"\n})\n\nmsg.request = {\n    headers : msg.headers\n}\n\nmsg.url = \"https://1betpro.com/ajax/\"\n\nmsg.payload = {\n    \"mode\" : \"lines\",\n    \"period\" : \"live\",\n    \"action\": \"cng\",\n    \"rnd\" : msg.timestamp,\n    \"human\" : 1,\n    \"delta_time\" : 0\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":1160,"y":340,"wires":[["ee2ebaf.4b8ef48"]]},{"id":"ee2ebaf.4b8ef48","type":"http request","z":"72706932.2ca048","name":"","method":"POST","ret":"txt","url":"","tls":"363f279c.1671a8","x":1350,"y":340,"wires":[["d113c026.30d02","a2d0f704.93d3b8","2156a8be.190a18"]]},{"id":"bf3db1de.5b3f8","type":"split","z":"e1fcddda.49088","name":"For Each 1BetPro Event","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":390,"y":440,"wires":[["fa6f23a9.c2e73"]]},{"id":"e0434152.2f6db","type":"function","z":"72706932.2ca048","name":"Prepare http Request","func":"msg.headers = {};\n\nmsg.headers['Accept-Language'] = 'en-US,en;q=0.9,es;q=0.8,sq;q=0.6' \nmsg.headers['User-Agent'] = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36' \nmsg.headers['Accept'] = 'application/json, text/javascript, */*; q=0.01' \nmsg.headers['Referer'] = 'http://www.966sport.com/live' \nmsg.headers['X-Requested-With'] = 'XMLHttpRequest' \nmsg.headers['Connection'] = 'keep-alive'\n\nmsg.headers['cookie'] = \"\";\n\nmsg.website.session.cookies.forEach( cookie => {\n    msg.headers['cookie'] = msg.headers['cookie'] + cookie.name + \"=\" + cookie.value +\";\"\n})\n\nmsg.url = \"http://www.966sport.com/ajax/live?selsport=all&_=\" + msg.timestamp;\n\nmsg.topic = \"966SPORT_HTTP_REQUEST_COMPLETED\";\nreturn msg;","outputs":1,"noerr":0,"x":1160,"y":700,"wires":[["ac6350b0.e7876"]]},{"id":"ac6350b0.e7876","type":"http request","z":"72706932.2ca048","name":"","method":"GET","ret":"txt","url":"","tls":"363f279c.1671a8","x":1350,"y":700,"wires":[["e50855e1.791b38","a2c0f8dc.4a48e8","25db78cc.4a45f8"]]},{"id":"16740cbc.486703","type":"json","z":"e1fcddda.49088","name":"","property":"payload","action":"","pretty":false,"x":970,"y":440,"wires":[[]]},{"id":"b50b2b0e.0d4a48","type":"config","z":"aca500a5.26ea7","name":"delay","properties":[{"p":"delay","pt":"flow","to":"0","tot":"num"}],"active":true,"x":590,"y":200,"wires":[]},{"id":"9b033c6a.ff22f","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":450,"y":640,"wires":[]},{"id":"7d64f751.58a0a8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":460,"y":440,"wires":[]},{"id":"3300be85.f4a2c2","type":"split","z":"72706932.2ca048","name":"For Each 966sport League","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1980,"y":680,"wires":[["78868ff9.5db25"]]},{"id":"c6ff8a6c.5a65a8","type":"change","z":"fd5c9c45.e7c55","name":"Set Line","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.line","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":200,"wires":[["72322ad1.a13b34"]]},{"id":"5f9d13c3.c32d0c","type":"switch","z":"fd5c9c45.e7c55","name":"Got Line","property":"payload.line","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":180,"y":200,"wires":[["c6ff8a6c.5a65a8"]]},{"id":"72322ad1.a13b34","type":"split","z":"fd5c9c45.e7c55","name":"For Each Line","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":480,"y":200,"wires":[["5c4c5c17.9aa634"]]},{"id":"2eef2642.5b346a","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":2520,"y":640,"wires":[]},{"id":"e81ef915.1d4e38","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2470,"y":740,"wires":[]},{"id":"d67ed55f.025e88","type":"subflow:e1fcddda.49088","z":"72706932.2ca048","name":"","x":2170,"y":300,"wires":[["e81d64b7.6032c8","c5f3bb7c.f534c8","b949f542.d1ee38"]]},{"id":"bfd80ccb.b371c","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":3140,"y":240,"wires":[]},{"id":"42dbeb0f.fc3cf4","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":3130,"y":360,"wires":[]},{"id":"64b40aef.230484","type":"function","z":"b7eb2a5f.2481a8","name":"Set Website","func":"//msg.website = msg;\n\nmsg.payload = [msg.website.name + \"_session\"];\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":240,"wires":[["be17b9da.733e28"]]},{"id":"be17b9da.733e28","type":"redis-command","z":"b7eb2a5f.2481a8","server":"3535b384.5d390c","command":"get","name":"","topic":"","x":420,"y":240,"wires":[["f31db5d1.1b9118"]]},{"id":"f31db5d1.1b9118","type":"json","z":"b7eb2a5f.2481a8","name":"","property":"payload","action":"","pretty":false,"x":550,"y":240,"wires":[["e7ad728d.fb27a"]]},{"id":"e7ad728d.fb27a","type":"switch","z":"b7eb2a5f.2481a8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"null","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":240,"wires":[["8a088a21.50a928"],["a56d9438.4aa278"]]},{"id":"a56d9438.4aa278","type":"change","z":"b7eb2a5f.2481a8","name":"Get Session","rules":[{"t":"set","p":"website.session","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"LOGIN_SUCCESS","tot":"str"},{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":280,"wires":[[]]},{"id":"f6c6cfcb.de8af","type":"redis-command","z":"b7eb2a5f.2481a8","server":"3535b384.5d390c","command":"set","name":"","topic":"","x":1140,"y":240,"wires":[[]]},{"id":"a7be1e21.862a5","type":"switch","z":"d94fb931.bab888","name":"Login Status","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"LOGIN_FAILED","vt":"str"},{"t":"eq","v":"LOGIN_SUCCESS","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":80,"wires":[[],["87e56684.c18a38"]]},{"id":"15c93f15.719d71","type":"function","z":"d94fb931.bab888","name":"Set Website","func":"//msg.website = msg;\n\nmsg.payload = [msg.website.name + \"_session\"];\n\nreturn msg;","outputs":1,"noerr":0,"x":210,"y":100,"wires":[["9a4223d5.9c4f6"]]},{"id":"9a4223d5.9c4f6","type":"redis-command","z":"d94fb931.bab888","server":"3535b384.5d390c","command":"get","name":"","topic":"","x":400,"y":100,"wires":[["e115ab39.9b8bd8"]]},{"id":"e115ab39.9b8bd8","type":"json","z":"d94fb931.bab888","name":"","property":"payload","action":"","pretty":false,"x":550,"y":100,"wires":[["7df2c60b.8a1f48"]]},{"id":"7df2c60b.8a1f48","type":"switch","z":"d94fb931.bab888","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"null","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":100,"wires":[["f33e6a44.9207c8"],["c49073ad.50203"]]},{"id":"c49073ad.50203","type":"change","z":"d94fb931.bab888","name":"Get Session","rules":[{"t":"set","p":"website.session","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"LOGIN_SUCCESS","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":140,"wires":[[]]},{"id":"87e56684.c18a38","type":"redis-command","z":"d94fb931.bab888","server":"3535b384.5d390c","command":"set","name":"","topic":"","x":1140,"y":100,"wires":[[]]},{"id":"14682161.4e2baf","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1110,"y":780,"wires":[]},{"id":"6a20042c.cd458c","type":"inject","z":"aca500a5.26ea7","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":560,"wires":[["211b0ffa.fd4b2"]]},{"id":"73617439.01c0bc","type":"redis-command","z":"aca500a5.26ea7","server":"3535b384.5d390c","command":"del","name":"","topic":"","x":600,"y":560,"wires":[["a8f2582.6f770a8"]]},{"id":"a8f2582.6f770a8","type":"debug","z":"aca500a5.26ea7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810,"y":560,"wires":[]},{"id":"211b0ffa.fd4b2","type":"function","z":"aca500a5.26ea7","name":"Delete Redis keys","func":"\nmsg.payload = [\n        '966sport_session',\n        '1betpro_session'/*,\n        'google_session',\n        'google_search_*'*/\n    ]\n    \nreturn msg;","outputs":1,"noerr":0,"x":390,"y":560,"wires":[["73617439.01c0bc"]]},{"id":"8da88dd2.944af","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1970,"y":740,"wires":[]},{"id":"717410a5.33831","type":"change","z":"72706932.2ca048","name":"List 966sport League Events","rules":[{"t":"set","p":"league","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload.events","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2480,"y":700,"wires":[["6e313773.ee4198","dbc6df13.8100b8"]]},{"id":"70755d81.236bc4","type":"change","z":"987d9c15.b3c5","name":"","rules":[{"t":"set","p":"documentIndex","pt":"msg","to":"\"bets\" & \"-\" & $replace($split($now(), \"T\", 1) [0],\"-\",\".\")","tot":"jsonata"},{"t":"set","p":"documentType","pt":"msg","to":"doc","tot":"str"},{"t":"set","p":"documentId","pt":"msg","to":"$base64encode(msg.payload.event.official.name & ';' & msg.payload.event.date & ';' & msg.payload.odd.type & ';' & msg.payload.odd.expires_on & ';' &  msg.payload.odd.run_line & ';' & msg.payload.odd.opponent)","tot":"jsonata"},{"t":"set","p":"payload.timestamp","pt":"msg","to":"","tot":"date"},{"t":"set","p":"google","pt":"msg","to":"{\t    \"q\" : msg.payload.event.name,\t    \"key\": \"google_session_test3\"\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1740,"y":880,"wires":[[]]},{"id":"33383dcd.33b232","type":"function","z":"987d9c15.b3c5","name":"Keep previous payload","func":"msg.payload = [\"v6_google_game_search_\" + msg.google.q];\n\nreturn msg;","outputs":1,"noerr":0,"x":180,"y":560,"wires":[["f4a50262.cb338"]]},{"id":"e9779b31.d35da8","type":"comment","z":"987d9c15.b3c5","name":"Get query result from cache","info":"","x":290,"y":500,"wires":[]},{"id":"f03b0cb4.d79d8","type":"function","z":"987d9c15.b3c5","name":"get google session from cache","func":"msg.payload = [msg.google.key];\n\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":420,"wires":[["bc585e9e.4cdde"]]},{"id":"bc585e9e.4cdde","type":"redis-command","z":"987d9c15.b3c5","server":"3535b384.5d390c","command":"get","name":"","topic":"","x":860,"y":420,"wires":[["689284cd.e8492c"]]},{"id":"689284cd.e8492c","type":"json","z":"987d9c15.b3c5","name":"","property":"payload","action":"","pretty":false,"x":990,"y":420,"wires":[["36987314.bc7d0c"]]},{"id":"36987314.bc7d0c","type":"switch","z":"987d9c15.b3c5","name":"Session in cache?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"null","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1150,"y":420,"wires":[["e53e4072.3e599"],["ed15abf.0b07558"]]},{"id":"87f89f95.df0ce","type":"redis-command","z":"987d9c15.b3c5","server":"3535b384.5d390c","command":"set","name":"","topic":"","x":2940,"y":480,"wires":[["30cd385b.2d81a8"]]},{"id":"30cd385b.2d81a8","type":"switch","z":"987d9c15.b3c5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":3070,"y":480,"wires":[[]]},{"id":"96ccb471.a7ea18","type":"change","z":"987d9c15.b3c5","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.href","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2740,"y":380,"wires":[["e001305f.3e3a3"]]},{"id":"ed6ee300.391be","type":"function","z":"987d9c15.b3c5","name":"","func":"msg.google.result = msg.payload;\n\nmsg.payload =[\"v6_google_game_search_\" + msg.google.q,JSON.stringify(msg.payload)]\n        \nreturn msg;","outputs":1,"noerr":0,"x":2810,"y":480,"wires":[["87f89f95.df0ce"]]},{"id":"d8890ab8.a55588","type":"change","z":"987d9c15.b3c5","name":"","rules":[{"t":"set","p":"google.result","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3280,"y":580,"wires":[[]]},{"id":"8c3672cd.acb0b","type":"change","z":"dd2ff415.75e098","name":"","rules":[{"t":"set","p":"documentIndex","pt":"msg","to":"\"bets\" & \"-\" & $replace($split($now(), \"T\", 1) [0],\"-\",\".\")","tot":"jsonata"},{"t":"set","p":"documentType","pt":"msg","to":"doc","tot":"str"},{"t":"set","p":"documentId","pt":"msg","to":"$base64encode(msg.payload.event.official & ';' & msg.payload.odd.type & ';' & msg.payload.odd.expires_on & ';' & msg.payload.odd.run_line)","tot":"jsonata"},{"t":"set","p":"payload.timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":240,"wires":[[]]},{"id":"ed15abf.0b07558","type":"change","z":"987d9c15.b3c5","name":"","rules":[{"t":"set","p":"google.session","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1370,"y":480,"wires":[["48dee163.2e4ab"]]},{"id":"6e313773.ee4198","type":"split","z":"72706932.2ca048","name":"For Each Event","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":2740,"y":700,"wires":[["ecdcad0c.e21c3","2e7dad80.913e8a"]]},{"id":"ecdcad0c.e21c3","type":"change","z":"72706932.2ca048","name":"","rules":[{"t":"set","p":"data","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"google","pt":"msg","to":"{\t    \"q\" : $replace($lowercase(msg.payload.home_team & ' vs ' & msg.payload.away_team),\" \",\"+\"),\t    \"key\": \"google_session_test3\"\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2940,"y":700,"wires":[["a7e37791.c543b8","aefa0785.32a2e8","890e7c96.dae9a"]]},{"id":"e001305f.3e3a3","type":"join","z":"987d9c15.b3c5","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2890,"y":380,"wires":[[]]},{"id":"10a87057.1c8f2","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":880,"y":480,"wires":[]},{"id":"f522eff1.97f54","type":"function","z":"72706932.2ca048","name":"","func":"\nlet website_json = JSON.stringify(msg.payload);\n\nmsg.payload.topic = msg.topic;\nmsg = msg.payload;\nmsg.website = JSON.parse(website_json);\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":540,"wires":[["555968b1.b7e128","6f4aa7aa.e205f8"]]},{"id":"aefa0785.32a2e8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":3160,"y":640,"wires":[]},{"id":"a7e37791.c543b8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":3130,"y":740,"wires":[]},{"id":"5c5a456d.bdcc9c","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":3340,"y":640,"wires":[]},{"id":"8b5e8a2f.623cd8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":3310,"y":740,"wires":[]},{"id":"b949f542.d1ee38","type":"change","z":"72706932.2ca048","name":"","rules":[{"t":"set","p":"data","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"google","pt":"msg","to":"{\t    \"q\" : $replace($lowercase(msg.payload.teams[0] & ' vs ' & msg.payload.teams[1]),\" \",\"+\"),\t    \"key\": \"google_session_test3\"\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2420,"y":300,"wires":[["54747ff2.5765b","d1eef3ab.51dc7","dc39a45a.1ce568"]]},{"id":"d1eef3ab.51dc7","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":2620,"y":240,"wires":[]},{"id":"54747ff2.5765b","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2610,"y":360,"wires":[]},{"id":"dc39a45a.1ce568","type":"subflow:987d9c15.b3c5","z":"72706932.2ca048","name":"","x":2620,"y":300,"wires":[["eb86aaf8.563868","8e008302.34eac","bb2abe61.a0402"]]},{"id":"eb86aaf8.563868","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":2840,"y":240,"wires":[]},{"id":"8e008302.34eac","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2810,"y":360,"wires":[]},{"id":"181fd787.5b70d8","type":"rdkafka out","z":"72706932.2ca048","name":"save-document","topic":"","key":"","partition":-1,"broker":"c0e67585.074708","x":3320,"y":300,"wires":[]},{"id":"3f7b90cd.00658","type":"function","z":"72706932.2ca048","name":"Stringify Message","func":"\nmsg = {\n    documentIndex: msg.documentIndex,\n    documentType: msg.documentType,\n    documentId: msg.documentId,\n    payload: msg.payload,\n    debug: msg.debug,\n    flow: msg.flow\n}\n\nmsg.payload = JSON.stringify(msg);\nmsg.topic   = msg.flow + \"-save-document\";\n\nreturn msg;","outputs":1,"noerr":0,"x":3130,"y":300,"wires":[["181fd787.5b70d8"]]},{"id":"c11046c9.e9f1d8","type":"html","z":"987d9c15.b3c5","name":"","property":"payload","tag":"div.ellipsisize","ret":"text","as":"single","x":2490,"y":480,"wires":[["5146d0ba.a9cef"]]},{"id":"ef0a6a7b.46d028","type":"change","z":"987d9c15.b3c5","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3140,"y":360,"wires":[[]]},{"id":"5146d0ba.a9cef","type":"switch","z":"987d9c15.b3c5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":2690,"y":480,"wires":[["ed6ee300.391be"]]},{"id":"9e2a6954.1c2ee8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":640,"y":440,"wires":[]},{"id":"6f4aa7aa.e205f8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":670,"y":640,"wires":[]},{"id":"c0a9ab2.c592258","type":"switch","z":"987d9c15.b3c5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":" \"\"","vt":"str"},{"t":"nnull"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":510,"y":560,"wires":[["5dca098e.2c9958"],["5dca098e.2c9958"],["f03b0cb4.d79d8"]]},{"id":"dbc6df13.8100b8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2730,"y":740,"wires":[]},{"id":"2e7dad80.913e8a","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2930,"y":740,"wires":[]},{"id":"78868ff9.5db25","type":"switch","z":"72706932.2ca048","name":"Is it real league?","property":"payload.liga","propertyType":"msg","rules":[{"t":"cont","v":"- corners","vt":"str"},{"t":"cont","v":"- specific 15 mins","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":2200,"y":680,"wires":[[],[],["717410a5.33831","e81ef915.1d4e38","2eef2642.5b346a"]]},{"id":"5f9e7951.b92058","type":"function","z":"52f2656a.61247c","name":"","func":"var DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n\nvar odd_mapper = function(odd, type, expires_on){\n    \n    let sign = parseInt((type===\"Over/Under\") ? \"-1\" : \"1\");\n    \n    return {\n        \"type\" : type,\n        \"expires_on\" : expires_on,\n        \"run_line\" : ((odd.length>2) ? 1 : parseFloat((odd[0][2]==\"pk\") ? 0 : odd[0][2])).toString() + \"/\" + (sign * ((odd.length>2) ? 1 : parseFloat((odd[1][2]==\"pk\") ? 0 : odd[1][2]))).toString(),\n        \"1betpro\": {\n            \"id_1\" : odd[0][0].replace(\"__\",\"\"),\n            \"money_line_1\"  : parseFloat(odd[0][1]),\n            \"run_line_1\"  : parseFloat((odd.length>2) ? 1 : parseFloat((odd[0][2]==\"pk\") ? 0 : odd[0][2])),\n        \n            \"id_2\" : odd[1][0].replace(\"__\",\"\"),\n            \"money_line_2\"  : parseFloat(odd[1][1]),\n            \"run_line_2\"  : parseFloat(sign * ((odd.length>2) ? 1 : parseFloat((odd[1][2]==\"pk\") ? 0 : odd[1][2]))),\n            \n            \"id_0\" : (odd.length>2) ? odd[2][0].replace(\"__\",\"\") : null,\n            \"money_line_0\"  : (odd.length>2) ? parseFloat(odd[2][1]) : null,\n            \"run_line_0\" : (odd.length>2) ? parseFloat(1) : null\n        }\n    };\n}\n\nDate.prototype.getRoundHours = function() {\n  var mm = this.getMonth() + 1; // getMonth() is zero-based\n  var dd = this.getDate();\n  \n  return [this.getFullYear()     + '-',\n          (mm>9 ? '' : '0') + mm + '-',\n          (dd>9 ? '' : '0') + dd ,\n         ].join('');\n};\n\nlet odds = [];\n\ntry{\n    \n    let event_date = new Date();\n    let event_rounded_date = event_date.getRoundHours();\n\n    let event_hour = msg.data.date.replace('<span class=\"tablo_time\">','').replace('</span>','');\n    \n    event_date = new Date(event_rounded_date.toString() + ' ' + event_hour + \":00\");\n    \nlet event = {\n    \"name\" : (msg.data.teams[0] + ' vs ' + msg.data.teams[1]).toLowerCase(),\n    \"official\": (msg.google.result.length>0) ? msg.google.result[0].toLowerCase() : (msg.data.teams[0] + ' vs ' + msg.data.teams[1]).toLowerCase(),\n    \"participants\" : msg.data.teams.map(team => {return team.toLowerCase()}),\n    \"date\" : event_date.getTime(),\n    \"score\" : (msg.data.hasOwnProperty(\"add_inf\")) ? ((msg.data.add_inf.hasOwnProperty(\"sc1\")) ? msg.data.add_inf.sc1 : 0) + ' - ' + ((msg.data.add_inf.hasOwnProperty(\"sc2\")) ? msg.data.add_inf.sc2 : 0) : '0 - 0',\n    \"league.name\" : msg.data.league.toLowerCase(),\n    \"sport.name\" : msg.data.sport.toLowerCase(),\n    \"minute\": (msg.data.hasOwnProperty(\"add_inf\")) ? parseInt(msg.data.add_inf.minute.replace(\"'\")) : 0\n}\n\nlet orig_odds = msg.data.sg[\"1\"];\n\n\nif(orig_odds.hasOwnProperty(\"ft\")){\n    \n    if(orig_odds.ft.hasOwnProperty(\"1x2\")){\n        odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(orig_odds.ft[\"1x2\"],\"1x2\",\"Full Time\")\n            });\n    }\n    \n    if(orig_odds.ft.hasOwnProperty(\"ou\")){\n        orig_odds.ft.ou.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(odd,\"Over/Under\",\"Full Time\")\n            });\n        })\n    }\n    \n    if(orig_odds.ft.hasOwnProperty(\"ah\")){\n        orig_odds.ft.ah.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(odd,\"Handicap\",\"Full Time\")\n            });\n        })\n    }\n}\n  \nif(orig_odds.hasOwnProperty(\"ht\")){\n    \n    if(orig_odds.ht.hasOwnProperty(\"1x2\")){\n        odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(orig_odds.ht[\"1x2\"],\"1x2\",\"1st Half\")\n            });\n    }\n    \n    if(orig_odds.ht.hasOwnProperty(\"ou\")){\n        orig_odds.ht.ou.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(odd,\"Over/Under\",\"1st Half\")\n            });\n        })\n    }\n    \n    if(orig_odds.ht.hasOwnProperty(\"ah\")){\n        orig_odds.ht.ah.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(odd,\"Handicap\",\"1st Half\")\n            });\n        })\n    }\n}\n\n//log(msg.page.website.name + ' -- Finish Transformation, got ' + odds.length + ' rows');\n\n/*odds = odds.map(odd => {\n    Object.keys(odd).map(function(key, index) {\n       odd[key] = (odd[key]===null || odd[key]===undefined) ? \"-1\" : odd[key];\n    });\n})*/\n}\ncatch(e){\n    //node.error(e);\n    msg.error = e;\n}\n\nmsg.payload = odds;\n\nreturn msg;","outputs":1,"noerr":0,"x":130,"y":200,"wires":[["9f5860af.d57d4"]]},{"id":"60541e7e.afaec","type":"function","z":"dd2ff415.75e098","name":"","func":"var DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n\nvar odd_mapper = function(odd, type, expires_on){\n    \n    return {\n        \"odd\": {\n            \n            \"type\" : type,\n            \"expires_on\" : expires_on,\n            \n            \"1betpro\": {\n                \"id_1\" : odd[0][0].replace(\"__\",\"\"),\n                \"money_line_1\"  : parseFloat(odd[0][1]),\n                \"run_line_1\"  : (odd.length>2) ? 1 : parseFloat((odd[0][2]==\"pk\") ? 0 : odd[0][2]),\n            \n                \"id_2\" : odd[1][0].replace(\"__\",\"\"),\n                \"money_line_2\"  : parseFloat(odd[1][1]),\n                \"run_line_2\"  : (odd.length>2) ? 1 : parseFloat((odd[1][2]==\"pk\") ? 0 : odd[1][2]),\n                \n                \"id_0\" : (odd.length>2) ? odd[2][0].replace(\"__\",\"\") : null,\n                \"money_line_0\"  : (odd.length>2) ? parseFloat(odd[2][1]) : null,\n                \"run_line_0\" : (odd.length>2) ? 1 : null\n            }\n        }\n    };\n}\n\nDate.prototype.getRoundHours = function() {\n  var mm = this.getMonth() + 1; // getMonth() is zero-based\n  var dd = this.getDate();\n  \n  return [this.getFullYear()     + '-',\n          (mm>9 ? '' : '0') + mm + '-',\n          (dd>9 ? '' : '0') + dd ,\n         ].join('');\n};\n\nlet odds = [];\n\ntry{\n    \n    let event_date = new Date();\n    let event_rounded_date = event_date.getRoundHours();\n\n    let event_hour = msg.data.date.replace('<span class=\"tablo_time\">','').replace('</span>','');\n    \n    event_date = new Date(event_rounded_date.toString() + ' ' + event_hour + \":00\");\n    \nlet event = {\n    \"name\" : (msg.data.teams[0] + ' vs ' + msg.data.teams[1]).toLowerCase(),\n    \"official\": (msg.google.result.length>0) ? msg.google.result[0].toLowerCase() : (msg.data.teams[0] + ' vs ' + msg.data.teams[1]).toLowerCase(),\n    \"participants\" : msg.data.teams.map(team => {return team.toLowerCase()}),\n    \"date\" : event_date.getTime(),\n    \"score\" : (msg.data.hasOwnProperty(\"add_inf\")) ? ((msg.data.add_inf.hasOwnProperty(\"sc1\")) ? msg.data.add_inf.sc1 : 0) + ' - ' + ((msg.data.add_inf.hasOwnProperty(\"sc2\")) ? msg.data.add_inf.sc2 : 0) : '0 - 0',\n    \"league.name\" : msg.data.league.toLowerCase(),\n    \"sport.name\" : msg.data.sport.toLowerCase(),\n    \"minute\": (msg.data.hasOwnProperty(\"add_inf\")) ? parseInt(msg.data.add_inf.minute.replace(\"'\")) : 0\n}\n\nlet orig_odds = msg.data.sg[\"1\"];\n\n\nif(orig_odds.hasOwnProperty(\"ft\")){\n    \n    if(orig_odds.ft.hasOwnProperty(\"1x2\")){\n        odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(orig_odds.ft[\"1x2\"],\"1x2\",\"Full Time\")\n            });\n    }\n    \n    if(orig_odds.ft.hasOwnProperty(\"ou\")){\n        orig_odds.ft.ou.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(odd,\"Over/Under\",\"Full Time\")\n            });\n        })\n    }\n    \n    if(orig_odds.ft.hasOwnProperty(\"ah\")){\n        orig_odds.ft.ah.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(odd,\"Handicap\",\"Full Time\")\n            });\n        })\n    }\n}\n  \nif(orig_odds.hasOwnProperty(\"ht\")){\n    \n    if(orig_odds.ht.hasOwnProperty(\"1x2\")){\n        odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(orig_odds.ht[\"1x2\"],\"1x2\",\"1st Half\")\n            });\n    }\n    \n    if(orig_odds.ht.hasOwnProperty(\"ou\")){\n        orig_odds.ht.ou.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(odd,\"Over/Under\",\"1st Half\")\n            });\n        })\n    }\n    \n    if(orig_odds.ht.hasOwnProperty(\"ah\")){\n        orig_odds.ht.ah.forEach(odd => {\n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(odd,\"Handicap\",\"1st Half\")\n            });\n        })\n    }\n}\n\n//log(msg.page.website.name + ' -- Finish Transformation, got ' + odds.length + ' rows');\n\n/*odds = odds.map(odd => {\n    Object.keys(odd).map(function(key, index) {\n       odd[key] = (odd[key]===null || odd[key]===undefined) ? \"-1\" : odd[key];\n    });\n})*/\n}\ncatch(e){\n    //node.error(e);\n    msg.error = e;\n}\n\nmsg.payload = odds;\n\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":360,"wires":[[]]},{"id":"d510851f.9e89a8","type":"function","z":"dd2ff415.75e098","name":"Transform","func":"var DEBUG=msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n\nvar odd_mapper = function(odd, type, expires_on){\n    \n    try{\n            \n        let codes = {\n            \"Full Time\" :\"FT\",\n            \"1st Half\" : \"FH\",\n            \"1x2\" : \"1X2\",\n            \"Handicap\" : \"HDP\",\n            \"Over/Under\" : \"OU\"\n        }\n        \n        let opponent_1 = (type === \"Over/Under\") ? \"o\" : \"h\";\n        let opponent_2 = (type === \"Over/Under\") ? \"u\" : \"a\";\n        let opponent_0 = (type === \"1x2\") ? \"d\" : null;\n\n        let sign = parseInt((type === \"Over/Under\") ? \"-1\" : \"1\");\n\n        return {\n            \"type\"          :  type,\n            \"expires_on\"    :  expires_on,\n            \"run_line\"      :  (parseFloat(msg.data[codes[expires_on] + '_' + codes[type] + '_' + opponent_1 + \"_op\"].toString().trim().replace(\" \",\"\"))).toString() + \"/\" + (sign * parseFloat(msg.data[codes[expires_on] + '_' + codes[type] + '_' + opponent_2 + \"_op\"].toString().trim().replace(\" \",\"\"))).toString(),\n            \"966sport\": {\n                \"id_1\"           :  (msg.data.id_e + codes[expires_on] + '_' + codes[type] + '_' + opponent_1 + '_' + msg.data[codes[expires_on] + '_' + codes[type] + '_' + opponent_1 + \"_op\"].toString()).trim().replace(\" \",\"\"),\n                \"money_line_1\"   :  parseFloat(msg.data[codes[expires_on] + '_' + codes[type] + '_' + opponent_1].toString().trim().replace(\" \",\"\")),\n                \"run_line_1\"     :  parseFloat(msg.data[codes[expires_on] + '_' + codes[type] + '_' + opponent_1 + \"_op\"].toString().trim().replace(\" \",\"\")),\n                \n                \"id_2\"           :  (msg.data.id_e + codes[expires_on] + '_' + codes[type] + '_' + opponent_2 + '_' + msg.data[codes[expires_on] + '_' + codes[type] + '_' + opponent_1 + \"_op\"].toString()).trim().replace(\" \",\"\"),\n                \"money_line_2\"   :  parseFloat(msg.data[codes[expires_on] + '_' + codes[type] + '_' + opponent_2].toString().trim().replace(\" \",\"\")),\n                \"run_line_2\"     :  sign * parseFloat(msg.data[codes[expires_on] + '_' + codes[type] + '_' + opponent_2 + \"_op\"].toString().trim().replace(\" \",\"\")),\n                \n                \"id_0\"           :  opponent_0!==null ? (msg.data.id_e + codes[expires_on] + '_' + codes[type] + '_' + opponent_0).trim().replace(\" \",\"\") : null,\n                \"money_line_0\"   :  opponent_0!==null ? parseFloat(msg.data[codes[expires_on] + '_' + codes[type] + '_' + opponent_0].toString().trim().replace(\" \",\"\")) : null,\n                \"run_line_0\"     :  opponent_0!==null ? parseFloat(1) : null\n            }\n        }\n    }\n    catch(e){\n        log(e.message)\n    }\n}\n\nDate.prototype.getRoundHours = function() {\n  var mm = this.getMonth() + 1; // getMonth() is zero-based\n  var dd = this.getDate();\n  var hh = this.getHours();\n  \n  return [this.getFullYear()     + '-',\n          (mm>9 ? '' : '0') + mm + '-',\n          (dd>9 ? '' : '0') + dd + 'T',\n          (hh>9 ? '' : '0') + hh + ':00:00.000Z',\n         ].join('');\n};\n\nlet odds = [];\n\ntry{\n    \n    let event_date = new Date();\n    let event_rounded_date = event_date.getRoundHours();\n\n    let event_minute = parseInt(msg.data.date);\n    \n    if(msg.data.date.includes(\"LIVE\") || msg.data.date.includes(\"Half Time\")){\n        //event_date = event_rounded_date;\n        //event_minute = 0;\n    }\n    else if(event_minute>=0){\n        \n        event_date.setMinutes(event_date.getMinutes() - event_minute);\n        event_date.setMinutes(event_date.getMinutes() - (event_date.getMinutes() % 5));\n        \n        event_date.setSeconds(\"00\");\n        event_date.setMilliseconds(\"000\");\n        \n        event_minute = event_minute;\n    }\n    else{\n        event_date = \"1900-01-01T00:00:00.000Z\";\n        event_minute = -1;\n    }\n    \n    //event_date = event_date.toString().replace(\"T\",\" \").replace(\".000Z\",\"\");\n    \n    msg.data.score_h = isNaN(parseInt(msg.data.score_h)) ? 0 : parseInt(msg.data.score_h)\n    msg.data.score_a = isNaN(parseInt(msg.data.score_a)) ? 0 : parseInt(msg.data.score_a)\n    \n    const event= {\n            name: (msg.data.home_team + ' vs ' + msg.data.away_team).toLowerCase(),\n            official: msg.google.result.length>0 ? msg.google.result[0].toLowerCase() : (msg.data.home_team + ' vs ' + msg.data.away_team).toLowerCase(),\n            //date: event_date.getTime(),\n            participants: [msg.data.home_team.toLowerCase(),msg.data.away_team.toLowerCase()],\n            score: msg.data.score_h + ' - ' + msg.data.score_a,\n            //minute: event_minute,\n            league: {\n                name: msg.league.liga.toLowerCase()\n            },\n            sport: {\n                name: msg.league.sport.toLowerCase()\n            }\n        };\n     \n    // 1x2\n    // Full Time \n    if(msg.data.hasOwnProperty(\"FT_1X2_h\") && msg.data.hasOwnProperty(\"FT_1X2_a\")){\n        \n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(msg.data,\"1x2\",\"Full Time\")\n            });\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    // 1st Half\n    if(msg.data.hasOwnProperty(\"FH_1X2_h\") && msg.data.hasOwnProperty(\"FH_1X2_a\")){\n        \n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(msg.data,\"1x2\",\"1st Half\")\n            });\n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    // Handicap\n    // Full Time\n    if(msg.data.hasOwnProperty(\"FT_HDP_h\") && msg.data.hasOwnProperty(\"FT_HDP_a\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(msg.data,\"Handicap\",\"Full Time\")\n            });\n        }\n        catch(e){\n            log(e.message)\n        }\n    } \n    \n    // 1st Half\n    if(msg.data.hasOwnProperty(\"FH_HDP_h\") && msg.data.hasOwnProperty(\"FH_HDP_a\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(msg.data,\"Handicap\",\"1st Half\")\n            });\n        }\n        catch(e){\n            log(e.message)\n        }\n    } \n    \n    // Over/Under\n    // Full Time\n    if(msg.data.hasOwnProperty(\"FT_OU_o\") && msg.data.hasOwnProperty(\"FT_OU_u\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(msg.data,\"Over/Under\",\"Full Time\")\n            })\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    // Over/Under\n    // 1st Half\n    if(msg.data.hasOwnProperty(\"FH_OU_o\") && msg.data.hasOwnProperty(\"FH_OU_u\")){\n        try{\n            \n            odds.push({\n                \"event\" : event,\n                \"odd\": odd_mapper(msg.data,\"Over/Under\",\"1st Half\")\n            })\n            \n        }\n        catch(e){\n            log(e.message)\n        }\n    }\n    \n    msg.payload = odds;\n    \n    return msg;\n}\ncatch(e){\n    //node.error(e)\n    \n    msg.payload = odds;\n    msg.error = e;\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":190,"y":180,"wires":[["4c200cfb.9e86b4"]]},{"id":"7812efa.3ecdb1","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1980,"y":620,"wires":[]},{"id":"e50855e1.791b38","type":"function","z":"72706932.2ca048","name":"Check Response","func":"\ntry{\n   msg.payload = JSON.parse(msg.payload);\n    msg.topic   = msg.flow + \"-966sport-session-alive\";\n   return msg;\n}\ncatch(e){\n    msg.topic   = msg.flow + \"-966sport-session-expired\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":1530,"y":700,"wires":[["2e5072d5.d9f94e"]]},{"id":"2e5072d5.d9f94e","type":"switch","z":"72706932.2ca048","name":"Session Alive?","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"albert-966sport-session-alive","vt":"str"},{"t":"eq","v":"albert-966sport-session-expired","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1720,"y":700,"wires":[["7812efa.3ecdb1","3300be85.f4a2c2","8da88dd2.944af"],["9c9a0fcc.b18c7","82cc09f1.a6a5b8"]]},{"id":"a2d0f704.93d3b8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1520,"y":280,"wires":[]},{"id":"d113c026.30d02","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1510,"y":400,"wires":[]},{"id":"340471df.fe8afe","type":"switch","z":"72706932.2ca048","name":"Session Alive?","property":"payload.error","propertyType":"msg","rules":[{"t":"else"},{"t":"eq","v":"login","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1720,"y":340,"wires":[["22452de0.538f82","9bfe377e.616698","990542a6.c5e6c"],["a5276c18.7e342","9bfe377e.616698","b7aabd17.04efa"]]},{"id":"2156a8be.190a18","type":"function","z":"72706932.2ca048","name":"Check Response","func":"\ntry{\n    msg.payload = JSON.parse(msg.payload);\n    msg.topic   = msg.flow + \"-1betpro-session-alive\";\n    return msg;\n}\ncatch(e){\n    msg.topic   = msg.flow + \"-1betpro-session-expired\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":1530,"y":340,"wires":[["340471df.fe8afe"]]},{"id":"f73f710.d3a749","type":"function","z":"381da27a.bf1b8e","name":"Stringify Message and reset cache","func":"\n/*msg = {\n    documentIndex: msg.documentIndex,\n    documentType: msg.documentType,\n    documentId: msg.documentId,\n    payload: msg.payload,\n    debug: msg.debug,\n    flow: msg.flow\n}*/\n\nmsg.prev_payload = JSON.stringify(msg);\nmsg.payload = [msg.website.name + \"_session\"];\n\nif(msg.hasOwnProperty(\"retry\")){\n    if(msg.retry<3){\n        msg.retry = msg.retry + 1;\n    }\n}\nelse{\n    msg.retry = 1;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":220,"wires":[["2b5cd9d9.ad7146"]]},{"id":"a5276c18.7e342","type":"subflow:381da27a.bf1b8e","z":"72706932.2ca048","name":"","x":1960,"y":440,"wires":[["1122493b.3f7c77"]]},{"id":"2b5cd9d9.ad7146","type":"redis-command","z":"381da27a.bf1b8e","server":"3535b384.5d390c","command":"del","name":"","topic":"","x":660,"y":220,"wires":[["25590db2.b2a722"]]},{"id":"9c9a0fcc.b18c7","type":"subflow:381da27a.bf1b8e","z":"72706932.2ca048","name":"","x":1960,"y":840,"wires":[["b9ab086b.7e3708"]]},{"id":"b7aabd17.04efa","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1940,"y":400,"wires":[]},{"id":"82cc09f1.a6a5b8","type":"debug","z":"72706932.2ca048","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1940,"y":780,"wires":[]},{"id":"cd5febc9.816348","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":870,"y":600,"wires":[]},{"id":"1122493b.3f7c77","type":"rdkafka out","z":"72706932.2ca048","name":"session expired","topic":"","key":"","partition":-1,"broker":"c0e67585.074708","x":2160,"y":440,"wires":[]},{"id":"b9ab086b.7e3708","type":"rdkafka out","z":"72706932.2ca048","name":"session expired","topic":"","key":"","partition":-1,"broker":"c0e67585.074708","x":2160,"y":840,"wires":[]},{"id":"a2c0f8dc.4a48e8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"topic","x":1520,"y":640,"wires":[]},{"id":"25db78cc.4a45f8","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1510,"y":760,"wires":[]},{"id":"20fb1a9c.949976","type":"function","z":"381da27a.bf1b8e","name":"","func":"msg.payload = msg.prev_payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":220,"wires":[[]]},{"id":"e3369fff.039ef","type":"function","z":"920d75bc.d0fe08","name":"Get Data","func":"'use strict';\n\nvar DEBUG = msg.debug; // Enable logging\n\nvar log = function(){\n    if(DEBUG){\n        console.log.apply(console, arguments);\n    }\n}\n    \nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n    \nconst puppeteer = global.get('puppeteer');\n\n(async() => {\n    \n    const browser = await puppeteer.launch({slowMo: 250,args: ['--proxy-server=35.184.95.89:8118','--no-sandbox', '--disable-setuid-sandbox', '--shm-size=1gb', '--disable-dev-shm-usage']}); //});//{headless: false\n    let page = await browser.newPage();\n    page.setUserAgent('Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36');\n    \n    try{\n        \n        log(msg.website.name + ' -- Go to ' + msg.website.url);\n        await page.goto(msg.website.url);\n        \n        let bodyText = await page.evaluate(() => document.body.innerText);\n        \n        msg.payload = bodyText;\n        \n        msg.topic = 'LOGIN_SUCCESS';\n        \n        node.send(msg);\n        \n        log(msg.website.name + ' -- Sending a ' + msg.topic + ' message');\n        await page.close();\n        await browser.close();\n    }\n    catch(e){\n        \n        node.error(e);\n        \n        msg.topic = 'LOGIN_FAILED';\n        \n        node.send(msg);\n        \n        log(msg.website.name + ' -- Sending a ' + msg.topic + ' message');\n        \n        await page.close();\n        await browser.close();\n    }\n})();","outputs":1,"noerr":0,"x":220,"y":280,"wires":[["cdbe34b2.cba798"]]},{"id":"cdbe34b2.cba798","type":"switch","z":"920d75bc.d0fe08","name":"Login Status","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"LOGIN_FAILED","vt":"str"},{"t":"eq","v":"LOGIN_SUCCESS","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":280,"wires":[[],["c13b73f6.149d6"]]},{"id":"c13b73f6.149d6","type":"json","z":"920d75bc.d0fe08","name":"","property":"payload","action":"","pretty":false,"x":620,"y":320,"wires":[["b9586c09.6f68d"]]},{"id":"b9586c09.6f68d","type":"change","z":"920d75bc.d0fe08","name":"Set Sport Type","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.l","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":320,"wires":[["d91f4016.3edd8"]]},{"id":"d91f4016.3edd8","type":"split","z":"920d75bc.d0fe08","name":"For Each Sport","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":980,"y":320,"wires":[["c24617a8.c53918"]]},{"id":"c24617a8.c53918","type":"change","z":"920d75bc.d0fe08","name":"Set Event Sport","rules":[{"t":"set","p":"event.sport.name","pt":"msg","to":"$lowercase($trim(msg.payload[1]))","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"payload[2]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":320,"wires":[["714fb8a8.698158"]]},{"id":"714fb8a8.698158","type":"split","z":"920d75bc.d0fe08","name":"For Each League","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1350,"y":320,"wires":[["160d99ab.eb8936"]]},{"id":"160d99ab.eb8936","type":"change","z":"920d75bc.d0fe08","name":"Set Event League","rules":[{"t":"set","p":"event.league.name","pt":"msg","to":"payload[1]","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload[2]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1550,"y":320,"wires":[["b4f7733a.fbab2"]]},{"id":"b4f7733a.fbab2","type":"split","z":"920d75bc.d0fe08","name":"For Each Event","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1740,"y":320,"wires":[["34ba41b9.00a3ae"]]},{"id":"34ba41b9.00a3ae","type":"change","z":"920d75bc.d0fe08","name":"Set Event name","rules":[{"t":"set","p":"event.name","pt":"msg","to":"$lowercase(msg.payload[1] & ' vs ' & msg.payload[2])","tot":"jsonata"},{"t":"set","p":"event.score","pt":"msg","to":"msg.payload[9][0] & ' - ' & msg.payload[9][1]","tot":"jsonata"},{"t":"set","p":"event.minute","pt":"msg","to":"$contains($trim(msg.payload[16]), \"2H\") ? $number($replace(msg.payload[15], \"'\", \"\")) + 45 : $number($replace(msg.payload[15], \"'\", \"\"))","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"payload[8]","tot":"msg"},{"t":"set","p":"odd","pt":"msg","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1920,"y":320,"wires":[["1f36ae93.ac3f01"]]},{"id":"fab3c7ae.148358","type":"split","z":"920d75bc.d0fe08","name":"For Each Event Period","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":2840,"y":320,"wires":[["1ed4c1a1.df339e"]]},{"id":"1ed4c1a1.df339e","type":"switch","z":"920d75bc.d0fe08","name":"Set Bet Window Time","property":"parts.index","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":3060,"y":320,"wires":[["12d1c6ff.208e89"],["4ca89c4.9c63264"]]},{"id":"57f3d996.310988","type":"split","z":"920d75bc.d0fe08","name":"For Each Odd Type","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":3410,"y":320,"wires":[["f9460e48.c51d2"]]},{"id":"12d1c6ff.208e89","type":"change","z":"920d75bc.d0fe08","name":"Full Time","rules":[{"t":"set","p":"odd.expires_on","pt":"msg","to":"Full Time","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3240,"y":300,"wires":[["57f3d996.310988"]]},{"id":"4ca89c4.9c63264","type":"change","z":"920d75bc.d0fe08","name":"1st Half","rules":[{"t":"set","p":"odd.expires_on","pt":"msg","to":"1st Half","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3240,"y":360,"wires":[["57f3d996.310988"]]},{"id":"f9460e48.c51d2","type":"switch","z":"920d75bc.d0fe08","name":"Odd Type Switch","property":"parts.index","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":3610,"y":320,"wires":[["b18809e1.0cd378"],["f3cdcfb3.c7a11"],["fce1a888.80ea48"]]},{"id":"b18809e1.0cd378","type":"change","z":"920d75bc.d0fe08","name":"Handicap","rules":[{"t":"set","p":"odd.type","pt":"msg","to":"Handicap","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3780,"y":280,"wires":[["85e1575a.1a6948"]]},{"id":"f3cdcfb3.c7a11","type":"change","z":"920d75bc.d0fe08","name":"Over/Under","rules":[{"t":"set","p":"odd.type","pt":"msg","to":"Over/Under","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3790,"y":320,"wires":[["85e1575a.1a6948"]]},{"id":"fce1a888.80ea48","type":"change","z":"920d75bc.d0fe08","name":"1x2","rules":[{"t":"set","p":"odd.type","pt":"msg","to":"1x2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3770,"y":360,"wires":[["85e1575a.1a6948"]]},{"id":"fd9b9d37.061f","type":"split","z":"920d75bc.d0fe08","name":"For Each Odd","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":4100,"y":320,"wires":[["6e8d2d9e.49fa04"]]},{"id":"8c716ceb.9affe","type":"change","z":"920d75bc.d0fe08","name":"Package Odd","rules":[{"t":"set","p":"odd.run_line","pt":"msg","to":"msg.payload[0] & '/' & msg.payload[1]","tot":"jsonata"},{"t":"set","p":"odd.pinibet","pt":"msg","to":"{\t    \"id_1\" : msg.payload[7],\t    \"money_line_1\"  : $number(msg.payload[3]),\t    \"run_line_1\"  : $number(msg.payload[0]),\t\t    \"id_2\" : msg.payload[7],\t    \"money_line_2\"  : $number(msg.payload[4]),\t    \"run_line_2\"  : $number(msg.payload[1])\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":4460,"y":320,"wires":[["7491e2fb.0f7f9c"]]},{"id":"6e8d2d9e.49fa04","type":"switch","z":"920d75bc.d0fe08","name":"Only Valid Odd","property":"payload.length","propertyType":"msg","rules":[{"t":"eq","v":"9","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":4280,"y":320,"wires":[["8c716ceb.9affe"]]},{"id":"7491e2fb.0f7f9c","type":"change","z":"920d75bc.d0fe08","name":"Package Row","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t    \"event\": msg.event,\t    \"odd\": msg.odd\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":4640,"y":320,"wires":[["357574e0.a4e85c"]]},{"id":"357574e0.a4e85c","type":"change","z":"920d75bc.d0fe08","name":"Package Document","rules":[{"t":"set","p":"documentIndex","pt":"msg","to":"\"bets\" & \"-\" & $replace($split($now(), \"T\", 1) [0],\"-\",\".\")","tot":"jsonata"},{"t":"set","p":"documentType","pt":"msg","to":"doc","tot":"str"},{"t":"set","p":"documentId","pt":"msg","to":"$base64encode($lowercase(msg.payload.event.official & ';' & msg.payload.odd.type & ';' & msg.payload.odd.expires_on & ';' & msg.payload.odd.run_line))","tot":"jsonata"},{"t":"set","p":"payload.timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":4830,"y":320,"wires":[[]]},{"id":"1f36ae93.ac3f01","type":"change","z":"920d75bc.d0fe08","name":"Set Google keywords","rules":[{"t":"set","p":"data","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"google","pt":"msg","to":"{\t    \"q\" : $replace($lowercase(msg.event.name),\" \",\"+\"),\t    \"key\": \"google_session_test3\"\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":320,"wires":[["8553c308.68b69"]]},{"id":"8553c308.68b69","type":"subflow:987d9c15.b3c5","z":"920d75bc.d0fe08","name":"","x":2320,"y":320,"wires":[["d45f16eb.25f3b8"]]},{"id":"d45f16eb.25f3b8","type":"change","z":"920d75bc.d0fe08","name":"Set Event Official name","rules":[{"t":"set","p":"payload","pt":"msg","to":"data","tot":"msg"},{"t":"set","p":"event.official","pt":"msg","to":"$count(msg.google.result)>0 ? $lowercase($trim(msg.google.result[0])) : $lowercase($trim(msg.event.name))","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2570,"y":320,"wires":[["fab3c7ae.148358"]]},{"id":"85e1575a.1a6948","type":"switch","z":"920d75bc.d0fe08","name":"Is Valid","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":3940,"y":320,"wires":[["fd9b9d37.061f"]]},{"id":"bdb9af20.eb965","type":"function","z":"72706932.2ca048","name":"Stringify Message","func":"\nmsg = {\n    documentIndex: msg.documentIndex,\n    documentType: msg.documentType,\n    documentId: msg.documentId,\n    payload: msg.payload,\n    debug: msg.debug,\n    flow: msg.flow\n}\n\nmsg.payload = JSON.stringify(msg);\nmsg.topic   = msg.flow + \"-save-document\";\n\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":940,"wires":[["73277ab7.52e434"]]},{"id":"73277ab7.52e434","type":"rdkafka out","z":"72706932.2ca048","name":"save-document","topic":"","key":"","partition":-1,"broker":"c0e67585.074708","x":1380,"y":940,"wires":[]},{"id":"982e21d2.e9ce7","type":"subflow:920d75bc.d0fe08","z":"72706932.2ca048","name":"","x":850,"y":960,"wires":[["bdb9af20.eb965"],["817acff1.da0f6"]]},{"id":"817acff1.da0f6","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1110,"y":980,"wires":[]},{"id":"6c896591.4ceb4c","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":850,"y":1020,"wires":[]},{"id":"58afba8e.5fad24","type":"debug","z":"72706932.2ca048","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":2110,"y":520,"wires":[]},{"id":"25590db2.b2a722","type":"delay","z":"381da27a.bf1b8e","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":820,"y":220,"wires":[["20fb1a9c.949976"]]}]